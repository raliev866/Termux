#!/data/data/com.termux/files/usr/bin/bash

# ==============================================
#  - 
# ==============================================
# –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2026.02.22
# –ê–≤—Ç–æ—Ä: –†–∞—Ñ–∞—ç–ª—å
# –û–ø–∏—Å–∞–Ω–∏–µ: 
# ==============================================

# -------------------- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø --------------------
WORK_DIR="/storage/emulated/0/Documents"
TEMP_DIR="$HOME/temp_${alias_name}"
INPUT_EXT="txt|md|dat"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
OUTPUT_EXT="out"         # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
FOLDER_SUFFIX=" - —Ä–µ–∑—É–ª—å—Ç–∞—Ç"

echo "=============================================="
echo "      - "
echo "=============================================="
echo "üìÅ –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞: $WORK_DIR"
echo ""

# -------------------- –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô --------------------
# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
# –ù–∞–ø—Ä–∏–º–µ—Ä:
# if ! command -v pandoc &> /dev/null; then
#     echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é pandoc..."
#     pkg install -y pandoc
# fi

# -------------------- –°–û–ó–î–ê–ù–ò–ï –†–ê–ë–û–ß–ï–ô –ü–ê–ü–ö–ò --------------------
if [ ! -d "$WORK_DIR" ]; then
    echo "üìÅ –ü–∞–ø–∫–∞ $WORK_DIR –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç! –°–æ–∑–¥–∞—é..."
    mkdir -p "$WORK_DIR"
    echo "‚úÖ –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞"
    echo ""
fi

# -------------------- –°–ß–Å–¢–ß–ò–ö–ò --------------------
FILES_FOUND=0
FILES_PROCESSED=0

echo "üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏..."
echo ""

# -------------------- –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ --------------------
# –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
TEMP_FILE=$(mktemp)

# –ó–¥–µ—Å—å —É–∫–∞–∂–∏—Ç–µ –º–∞—Å–∫—É –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
find "$WORK_DIR" -type f -name "*.$INPUT_EXT" 2>/dev/null > "$TEMP_FILE"

while IFS= read -r full_path; do
    
    FILES_FOUND=$((FILES_FOUND + 1))
    
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –æ—Ç WORK_DIR
    rel_path="${full_path#$WORK_DIR/}"
    filename=$(basename "$full_path" | sed 's/\.[^.]*$//')  # –£–¥–∞–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    filedir=$(dirname "$rel_path")
    
    echo "üìÑ [$FILES_FOUND] –ù–∞–π–¥–µ–Ω: $rel_path"
    
    # -------------------- –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–ê–ü–ö–ò –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø --------------------
    if [ "$filedir" = "." ]; then
        # –§–∞–π–ª –≤ –∫–æ—Ä–Ω–µ WORK_DIR
        output_dir="$WORK_DIR"
        echo "   ‚îî‚îÄ –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–¥–µ—Å—å –∂–µ"
    else
        # –§–∞–π–ª –≤ –ø–æ–¥–ø–∞–ø–∫–µ - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–µ—Ä–≤—É—é –ø–∞–ø–∫—É –≤ –ø—É—Ç–∏
        top_folder="${filedir%%/*}"
        
        # –°–æ–∑–¥–∞—ë–º —Ü–µ–ª–µ–≤—É—é –ø–∞–ø–∫—É: –≤–µ—Ä—Ö–Ω—è—è –ø–∞–ø–∫–∞ + —Å—É—Ñ—Ñ–∏–∫—Å + –æ—Å—Ç–∞–ª—å–Ω–æ–π –ø—É—Ç—å
        rest_path="${filedir#$top_folder}"
        target_folder="$WORK_DIR/${top_folder}${FOLDER_SUFFIX}${rest_path}"
        
        mkdir -p "$target_folder"
        output_dir="$target_folder"
        echo "   ‚îî‚îÄ –¶–µ–ª–µ–≤–∞—è –ø–∞–ø–∫–∞: ${top_folder}${FOLDER_SUFFIX}${rest_path}"
    fi
    
    output_file="$output_dir/$filename.$OUTPUT_EXT"
    
    echo "      ‚öôÔ∏è –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é: $filename"
    
    # -------------------- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê --------------------
    # –ó–î–ï–°–¨ –ù–£–ñ–ù–û –ù–ê–ü–ò–°–ê–¢–¨ –í–ê–®–£ –õ–û–ì–ò–ö–£ –û–ë–†–ê–ë–û–¢–ö–ò
    # –ù–∞–ø—Ä–∏–º–µ—Ä:
    # cp "$full_path" "$output_file"  # –ü—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º
    # –ò–ª–∏:
    # pandoc "$full_path" -o "$output_file"  # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º
    
    # –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å –Ω–æ–≤—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
    cp "$full_path" "$output_file"
    
    # -------------------- –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–ê --------------------
    if [ $? -eq 0 ] && [ -f "$output_file" ]; then
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞: 644 (rw-r--r--)
        chmod 644 "$output_file"
        echo "      ‚úÖ –ì–æ—Ç–æ–≤–æ: $filename.$OUTPUT_EXT"
        FILES_PROCESSED=$((FILES_PROCESSED + 1))
    else
        echo "      ‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
    fi
    
    echo ""
    
done < "$TEMP_FILE"

rm -f "$TEMP_FILE"

# -------------------- –ò–¢–û–ì --------------------
echo "=============================================="
echo "‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê"
echo "üìä –ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: $FILES_FOUND"
echo "üîÑ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: $FILES_PROCESSED"
echo "=============================================="

if [ $FILES_FOUND -eq 0 ]; then
    echo ""
    echo "‚ö†Ô∏è  –í –ø–∞–ø–∫–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏"
    echo "   –ü–æ–ª–æ–∂–∏—Ç–µ —Ñ–∞–π–ª—ã –≤: $WORK_DIR"
fi
—Ñ–∞–π–ª—ã –≤: $WORK_DIR"
fi
