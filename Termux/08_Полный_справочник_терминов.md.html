<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>08_Полный_справочник_терминов.md</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/storage/emulated/0/Documents/15_Настройки_скрипты_Termux_бекап_рестор/Шаблон_формата_текста/HTML_книги/scientific_style.css" />
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#полностью-понял-и-принял-задачу"
id="toc-полностью-понял-и-принял-задачу">✅ ПОЛНОСТЬЮ ПОНЯЛ И ПРИНЯЛ
ЗАДАЧУ!</a></li>
<li><a href="#полный-учебный-справочник-терминов"
id="toc-полный-учебный-справочник-терминов">📚 ПОЛНЫЙ УЧЕБНЫЙ СПРАВОЧНИК
ТЕРМИНОВ</a>
<ul>
<li><a href="#parameter-substitution-подстановка-параметров"
id="toc-parameter-substitution-подстановка-параметров">1️⃣ PARAMETER
SUBSTITUTION (ПОДСТАНОВКА ПАРАМЕТРОВ)</a>
<ul>
<li><a href="#определение" id="toc-определение">📖 ОПРЕДЕЛЕНИЕ</a></li>
<li><a href="#графический-рисунок" id="toc-графический-рисунок">🎨
ГРАФИЧЕСКИЙ РИСУНОК</a></li>
<li><a href="#скрипт-для-termux" id="toc-скрипт-для-termux">💻 СКРИПТ
ДЛЯ TERMUX</a></li>
<li><a href="#скрипт-для-pydroid-3" id="toc-скрипт-для-pydroid-3">🐍
СКРИПТ ДЛЯ PYDROID 3</a></li>
</ul></li>
<li><a href="#directory-tree-mirroring-зеркалирование-дерева-каталогов"
id="toc-directory-tree-mirroring-зеркалирование-дерева-каталогов">2️⃣
DIRECTORY TREE MIRRORING (ЗЕРКАЛИРОВАНИЕ ДЕРЕВА КАТАЛОГОВ)</a>
<ul>
<li><a href="#определение-1" id="toc-определение-1">📖
ОПРЕДЕЛЕНИЕ</a></li>
<li><a href="#графический-рисунок-1" id="toc-графический-рисунок-1">🎨
ГРАФИЧЕСКИЙ РИСУНОК</a></li>
<li><a href="#скрипт-для-termux-1" id="toc-скрипт-для-termux-1">💻
СКРИПТ ДЛЯ TERMUX</a></li>
<li><a href="#скрипт-для-pydroid-3-1" id="toc-скрипт-для-pydroid-3-1">🐍
СКРИПТ ДЛЯ PYDROID 3</a></li>
</ul></li>
<li><a href="#idempotency-идемпотентность"
id="toc-idempotency-идемпотентность">3️⃣ IDEMPOTENCY
(ИДЕМПОТЕНТНОСТЬ)</a>
<ul>
<li><a href="#определение-2" id="toc-определение-2">📖
ОПРЕДЕЛЕНИЕ</a></li>
<li><a href="#графический-рисунок-2" id="toc-графический-рисунок-2">🎨
ГРАФИЧЕСКИЙ РИСУНОК</a></li>
<li><a href="#скрипт-для-termux-2" id="toc-скрипт-для-termux-2">💻
СКРИПТ ДЛЯ TERMUX</a></li>
<li><a href="#скрипт-для-pydroid-3-2" id="toc-скрипт-для-pydroid-3-2">🐍
СКРИПТ ДЛЯ PYDROID 3</a></li>
</ul></li>
<li><a href="#reference-doc-workflow-работа-с-шаблонами-pandoc"
id="toc-reference-doc-workflow-работа-с-шаблонами-pandoc">4️⃣
REFERENCE-DOC WORKFLOW (РАБОТА С ШАБЛОНАМИ PANDOC)</a>
<ul>
<li><a href="#определение-3" id="toc-определение-3">📖
ОПРЕДЕЛЕНИЕ</a></li>
<li><a href="#графический-рисунок-3" id="toc-графический-рисунок-3">🎨
ГРАФИЧЕСКИЙ РИСУНОК</a></li>
<li><a href="#скрипт-для-termux-3" id="toc-скрипт-для-termux-3">💻
СКРИПТ ДЛЯ TERMUX</a></li>
</ul></li>
</ul></li>
<li><a href="#конвертируем-в-docx-это-будет-наш-reference-doc"
id="toc-конвертируем-в-docx-это-будет-наш-reference-doc">Конвертируем в
docx (это будет наш reference-doc)</a></li>
<li><a href="#шаг-2-инструкция-по-настройке-шаблона"
id="toc-шаг-2-инструкция-по-настройке-шаблона">===== ШАГ 2: ИНСТРУКЦИЯ
ПО НАСТРОЙКЕ ШАБЛОНА =====</a></li>
<li><a href="#шаг-3-демонстрационный-markdown"
id="toc-шаг-3-демонстрационный-markdown">===== ШАГ 3: ДЕМОНСТРАЦИОННЫЙ
MARKDOWN =====</a>
<ul>
<li><a href="#cat-markdown_file-eof" id="toc-cat-markdown_file-eof">cat
&gt; “$MARKDOWN_FILE” &lt;&lt; ‘EOF’</a></li>
</ul></li>
<li><a href="#введение" id="toc-введение">Введение</a>
<ul>
<li><a href="#подраздел-1.1" id="toc-подраздел-1.1">Подраздел 1.1</a>
<ul>
<li><a href="#ещё-более-глубокий-уровень"
id="toc-ещё-более-глубокий-уровень">Ещё более глубокий уровень</a></li>
</ul></li>
</ul></li>
<li><a href="#таблица-данных" id="toc-таблица-данных">Таблица
данных</a></li>
<li><a href="#список-задач" id="toc-список-задач">Список задач</a></li>
<li><a href="#пример-кода" id="toc-пример-кода">Пример кода</a></li>
<li><a href="#шаг-4-конвертация-с-reference-doc"
id="toc-шаг-4-конвертация-с-reference-doc">===== ШАГ 4: КОНВЕРТАЦИЯ С
REFERENCE-DOC =====</a></li>
<li><a href="#шаг-5-функция-для-повседневного-использования"
id="toc-шаг-5-функция-для-повседневного-использования">===== ШАГ 5:
ФУНКЦИЯ ДЛЯ ПОВСЕДНЕВНОГО ИСПОЛЬЗОВАНИЯ =====</a></li>
<li><a href="#пример-использования" id="toc-пример-использования">Пример
использования</a></li>
<li><a href="#шаг-6-интеграция-с-зеркальной-логикой"
id="toc-шаг-6-интеграция-с-зеркальной-логикой">===== ШАГ 6: ИНТЕГРАЦИЯ С
ЗЕРКАЛЬНОЙ ЛОГИКОЙ =====</a></li>
<li><a href="#поиск-и-обработка" id="toc-поиск-и-обработка">Поиск и
обработка</a></li>
<li><a href="#шаг-7-проверка-шрифтов"
id="toc-шаг-7-проверка-шрифтов">===== ШАГ 7: ПРОВЕРКА ШРИФТОВ
=====</a></li>
<li><a href="#использование"
id="toc-использование">Использование</a></li>
<li><a href="#шаг-8-создание-шаблона-python"
id="toc-шаг-8-создание-шаблона-python">===== ШАГ 8: СОЗДАНИЕ ШАБЛОНА
PYTHON =====</a>
<ul>
<li><a href="#полный-набор-все-расширения"
id="toc-полный-набор-все-расширения">📋 ПОЛНЫЙ НАБОР (все
расширения)</a></li>
<li><a href="#расширения-по-категориям"
id="toc-расширения-по-категориям">🔧 РАСШИРЕНИЯ ПО КАТЕГОРИЯМ</a>
<ul>
<li><a href="#таблицы" id="toc-таблицы">Таблицы</a></li>
<li><a href="#атрибуты" id="toc-атрибуты">Атрибуты</a></li>
<li><a href="#текст-и-разметка" id="toc-текст-и-разметка">Текст и
разметка</a></li>
<li><a href="#списки" id="toc-списки">Списки</a></li>
<li><a href="#блоки-и-структура" id="toc-блоки-и-структура">Блоки и
структура</a></li>
<li><a href="#метаданные" id="toc-метаданные">Метаданные</a></li>
<li><a href="#типографика" id="toc-типографика">Типографика</a></li>
</ul></li>
<li><a href="#примеры-использования" id="toc-примеры-использования">🚀
ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ</a>
<ul>
<li><a href="#для-книги-docx" id="toc-для-книги-docx">Для книги
(DOCX)</a></li>
<li><a href="#для-веба-html" id="toc-для-веба-html">Для веба
(HTML)</a></li>
<li><a href="#для-научной-статьи-pdf"
id="toc-для-научной-статьи-pdf">Для научной статьи (PDF)</a></li>
</ul></li>
<li><a href="#проверка-доступных-расширений"
id="toc-проверка-доступных-расширений">🔍 ПРОВЕРКА ДОСТУПНЫХ
РАСШИРЕНИЙ</a></li>
<li><a href="#быстрый-тест-расширения"
id="toc-быстрый-тест-расширения">⚡ БЫСТРЫЙ ТЕСТ РАСШИРЕНИЯ</a></li>
</ul></li>
<li><a href="#тестовый-запуск" id="toc-тестовый-запуск">===== ТЕСТОВЫЙ
ЗАПУСК =====</a></li>
</ul>
</nav>
<h2 id="полностью-понял-и-принял-задачу">✅ ПОЛНОСТЬЮ ПОНЯЛ И ПРИНЯЛ
ЗАДАЧУ!</h2>
<p>Я создам для тебя <strong>ПОЛНЫЙ УЧЕБНЫЙ СПРАВОЧНИК</strong> по
каждому термину. Вот структура, которую я буду использовать для каждого
термина:</p>
<pre><code>┌─────────────────────────────────────────────────────────┐
│                    ТЕРМИН (рус/eng)                      │
├─────────────────────────────────────────────────────────┤
│  📖 ОПРЕДЕЛЕНИЕ                                           │
│  └─ Простое объяснение + техническое определение         │
├─────────────────────────────────────────────────────────┤
│  🎨 ГРАФИЧЕСКИЙ РИСУНОК (в ASCII-графике)                │
│  └─ Визуальное представление концепции                    │
├─────────────────────────────────────────────────────────┤
│  💻 ПРОГРАММНЫЙ СКРИПТ (Termux)                           │
│  └─ Рабочий код для Termux с комментариями               │
├─────────────────────────────────────────────────────────┤
│  🐍 ПРОГРАММНЫЙ СКРИПТ (Pydroid 3)                        │
│  └─ Рабочий код для Python на Android                     │
└─────────────────────────────────────────────────────────┘</code></pre>
<p>Вот <strong>ПОЛНЫЙ СПРАВОЧНИК</strong>:</p>
<hr />
<h1 id="полный-учебный-справочник-терминов">📚 ПОЛНЫЙ УЧЕБНЫЙ СПРАВОЧНИК
ТЕРМИНОВ</h1>
<p><em>Версия 1.0 | Для Termux и Pydroid 3</em></p>
<hr />
<h2 id="parameter-substitution-подстановка-параметров">1️⃣ PARAMETER
SUBSTITUTION (ПОДСТАНОВКА ПАРАМЕТРОВ)</h2>
<h3 id="определение">📖 ОПРЕДЕЛЕНИЕ</h3>
<p><strong>Parameter Substitution</strong> — это техника манипуляции
строками в Bash, позволяющая извлекать, заменять и модифицировать части
переменных без использования внешних утилит (sed, awk).</p>
<p><strong>Технически:</strong> Операторы <code>${var#pattern}</code>,
<code>${var%pattern}</code>, <code>${var/pattern/replacement}</code>
которые работают на уровне shell, не создавая дочерних процессов.</p>
<h3 id="графический-рисунок">🎨 ГРАФИЧЕСКИЙ РИСУНОК</h3>
<pre><code>Исходная строка: &quot;/home/user/docs/report.md&quot;
─────────────────────────────────────────────────────────
${var#*/}      → &quot;home/user/docs/report.md&quot;
                (удаляет всё до ПЕРВОГО слеша)
                
${var##*/}     → &quot;report.md&quot;
                (удаляет всё до ПОСЛЕДНЕГО слеша)
                
${var%/*}      → &quot;/home/user/docs&quot;
                (удаляет всё после ПОСЛЕДНЕГО слеша)
                
${var%%/*}     → &quot;&quot; (пусто)
                (удаляет всё после ПЕРВОГО слеша)
                
${var/md/docx} → &quot;/home/user/docs/report.docx&quot;
                (заменяет md на docx)</code></pre>
<h3 id="скрипт-для-termux">💻 СКРИПТ ДЛЯ TERMUX</h3>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/data/data/com.termux/files/usr/bin/bash</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: parameter_demo.sh</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация Parameter Substitution</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Цвета для вывода</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="va">GREEN</span><span class="op">=</span><span class="st">&#39;\033[0;32m&#39;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="va">BLUE</span><span class="op">=</span><span class="st">&#39;\033[0;34m&#39;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="va">YELLOW</span><span class="op">=</span><span class="st">&#39;\033[1;33m&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="va">NC</span><span class="op">=</span><span class="st">&#39;\033[0m&#39;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">   ДЕМОНСТРАЦИЯ PARAMETER SUBSTITUTION</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Исходный путь</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="va">FILE_PATH</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/Идеология.md&quot;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">Исходный путь:</span><span class="va">${NC}</span><span class="st"> </span><span class="va">$FILE_PATH</span><span class="st">\n&quot;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ИЗВЛЕЧЕНИЕ ИМЕНИ ФАЙЛА</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="va">filename</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${FILE_PATH</span><span class="op">##</span><span class="pp">*</span>/<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;1. </span><span class="va">${GREEN}</span><span class="st">##*/</span><span class="va">${NC}</span><span class="st"> - имя файла:&quot;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${FILE_PATH}</span><span class="st"> → </span><span class="va">${filename}</span><span class="st">\n&quot;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ИЗВЛЕЧЕНИЕ ПАПКИ</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="va">directory</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${FILE_PATH</span><span class="op">%</span>/<span class="pp">*</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;2. </span><span class="va">${GREEN}</span><span class="st">%/*</span><span class="va">${NC}</span><span class="st"> - путь к папке:&quot;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${FILE_PATH}</span><span class="st"> → </span><span class="va">${directory}</span><span class="st">\n&quot;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ИЗВЛЕЧЕНИЕ РАСШИРЕНИЯ</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="va">extension</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${filename</span><span class="op">##</span><span class="pp">*</span>.<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;3. </span><span class="va">${GREEN}</span><span class="st">##*.</span><span class="va">${NC}</span><span class="st"> - расширение:&quot;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${filename}</span><span class="st"> → </span><span class="va">${extension}</span><span class="st">\n&quot;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ИМЯ БЕЗ РАСШИРЕНИЯ</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="va">basename</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${filename</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;4. </span><span class="va">${GREEN}</span><span class="st">%.*</span><span class="va">${NC}</span><span class="st"> - имя без расширения:&quot;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${filename}</span><span class="st"> → </span><span class="va">${basename}</span><span class="st">\n&quot;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. УДАЛЕНИЕ ПРЕФИКСА</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="va">prefix</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/&quot;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="va">relative</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${FILE_PATH</span><span class="op">#</span><span class="va">$prefix}</span><span class="st">&quot;</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;5. </span><span class="va">${GREEN}</span><span class="st">#prefix</span><span class="va">${NC}</span><span class="st"> - относительный путь:&quot;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${FILE_PATH}</span><span class="st"> → </span><span class="va">${relative}</span><span class="st">\n&quot;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. ЗАМЕНА РАСШИРЕНИЯ</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="va">new_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${FILE_PATH</span><span class="op">/%</span><span class="ss">md</span><span class="op">/</span>docx<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;6. </span><span class="va">${GREEN}</span><span class="st">/%md/docx</span><span class="va">${NC}</span><span class="st"> - замена расширения:&quot;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">${FILE_PATH}</span><span class="st"> → </span><span class="va">${new_path}</span><span class="st">\n&quot;</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. ИЗВЛЕЧЕНИЕ ПЕРВОЙ ПАПКИ (для зеркальной логики)</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="va">WORK_DIR</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2&quot;</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="va">full_path</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/00001. ПРОЕКТ_КНИГА_ИИ .md/01_КНИГА - сам продукт/глава1.md&quot;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="va">rel_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${full_path</span><span class="op">#</span><span class="va">$WORK_DIR</span>/<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="va">first_folder</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${rel_path</span><span class="op">%%</span>/<span class="pp">*</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="va">rest_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${rel_path</span><span class="op">#</span><span class="va">$first_folder}</span><span class="st">&quot;</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">Практика для зеркальной логики:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   WORK_DIR: </span><span class="va">$WORK_DIR</span><span class="st">&quot;</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   full_path: </span><span class="va">$full_path</span><span class="st">&quot;</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   rel_path: </span><span class="va">$rel_path</span><span class="st">&quot;</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   first_folder: </span><span class="va">$first_folder</span><span class="st">&quot;</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   rest_path: </span><span class="va">$rest_path</span><span class="st">&quot;</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span></code></pre></div>
<h3 id="скрипт-для-pydroid-3">🐍 СКРИПТ ДЛЯ PYDROID 3</h3>
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: parameter_demo.py</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация аналогов Parameter Substitution в Python</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Цветной вывод (опционально)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Colors:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    GREEN <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[92m&#39;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    BLUE <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[94m&#39;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    YELLOW <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[93m&#39;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    NC <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[0m&#39;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_colored(text, color):</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>color<span class="sc">}{</span>text<span class="sc">}{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>Colors<span class="sc">.</span>BLUE<span class="sc">}</span><span class="ss">════════════════════════════════════════</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">   ДЕМОНСТРАЦИЯ PARAMETER SUBSTITUTION (Python)</span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>Colors<span class="sc">.</span>BLUE<span class="sc">}</span><span class="ss">════════════════════════════════════════</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Исходный путь</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/Идеология.md&quot;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>Colors<span class="sc">.</span>YELLOW<span class="sc">}</span><span class="ss">Исходный путь:</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. ИЗВЛЕЧЕНИЕ ИМЕНИ ФАЙЛА (аналог ##*/)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> os.path.basename(file_path)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;1. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">basename</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - имя файла:&quot;</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. ИЗВЛЕЧЕНИЕ ПАПКИ (аналог %/*)</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>directory <span class="op">=</span> os.path.dirname(file_path)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;2. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">dirname</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - путь к папке:&quot;</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>directory<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. ИЗВЛЕЧЕНИЕ РАСШИРЕНИЯ (аналог ##*.)</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>extension <span class="op">=</span> filename.split(<span class="st">&#39;.&#39;</span>)[<span class="op">-</span><span class="dv">1</span>] <span class="cf">if</span> <span class="st">&#39;.&#39;</span> <span class="kw">in</span> filename <span class="cf">else</span> <span class="st">&#39;&#39;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;3. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">split()</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - расширение:&quot;</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>extension<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ИМЯ БЕЗ РАСШИРЕНИЯ (аналог %.*)</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>basename <span class="op">=</span> filename[:<span class="op">-</span>(<span class="bu">len</span>(extension)<span class="op">+</span><span class="dv">1</span>)] <span class="cf">if</span> extension <span class="cf">else</span> filename</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;4. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">срез строки</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - имя без расширения:&quot;</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>basename<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. УДАЛЕНИЕ ПРЕФИКСА (аналог #prefix)</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>prefix <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/&quot;</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>relative <span class="op">=</span> file_path.replace(prefix, <span class="st">&#39;&#39;</span>, <span class="dv">1</span>) <span class="cf">if</span> file_path.startswith(prefix) <span class="cf">else</span> file_path</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;5. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">replace()</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - относительный путь:&quot;</span>)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>relative<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. ЗАМЕНА РАСШИРЕНИЯ (аналог %md/docx)</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>new_path <span class="op">=</span> file_path.replace(<span class="st">&#39;.md&#39;</span>, <span class="st">&#39;.docx&#39;</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;6. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">replace()</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - замена расширения:&quot;</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>new_path<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. РАБОТА С PATHLIB (современный способ)</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> Path(file_path)</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;7. </span><span class="sc">{</span>Colors<span class="sc">.</span>GREEN<span class="sc">}</span><span class="ss">pathlib</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss"> - объектно-ориентированный подход:&quot;</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   parent: </span><span class="sc">{</span>path<span class="sc">.</span>parent<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   stem: </span><span class="sc">{</span>path<span class="sc">.</span>stem<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   suffix: </span><span class="sc">{</span>path<span class="sc">.</span>suffix<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   with_suffix: </span><span class="sc">{</span>path<span class="sc">.</span>with_suffix(<span class="st">&#39;.docx&#39;</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. ИЗВЛЕЧЕНИЕ ПЕРВОЙ ПАПКИ (для зеркальной логики)</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>WORK_DIR <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2&quot;</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>full_path <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/00001. ПРОЕКТ_КНИГА_ИИ .md/01_КНИГА - сам продукт/глава1.md&quot;</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>rel_path <span class="op">=</span> full_path.replace(WORK_DIR, <span class="st">&#39;&#39;</span>).lstrip(<span class="st">&#39;/&#39;</span>)</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>parts <span class="op">=</span> rel_path.split(<span class="st">&#39;/&#39;</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>first_folder <span class="op">=</span> parts[<span class="dv">0</span>] <span class="cf">if</span> parts <span class="cf">else</span> <span class="st">&#39;&#39;</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>rest_path <span class="op">=</span> <span class="st">&#39;/&#39;</span> <span class="op">+</span> <span class="st">&#39;/&#39;</span>.join(parts[<span class="dv">1</span>:]) <span class="cf">if</span> <span class="bu">len</span>(parts) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">&#39;&#39;</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>Colors<span class="sc">.</span>YELLOW<span class="sc">}</span><span class="ss">Практика для зеркальной логики:</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   WORK_DIR: </span><span class="sc">{</span>WORK_DIR<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   full_path: </span><span class="sc">{</span>full_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   rel_path: </span><span class="sc">{</span>rel_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   first_folder: </span><span class="sc">{</span>first_folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;   rest_path: </span><span class="sc">{</span>rest_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="sc">{</span>Colors<span class="sc">.</span>BLUE<span class="sc">}</span><span class="ss">════════════════════════════════════════</span><span class="sc">{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<hr />
<h2 id="directory-tree-mirroring-зеркалирование-дерева-каталогов">2️⃣
DIRECTORY TREE MIRRORING (ЗЕРКАЛИРОВАНИЕ ДЕРЕВА КАТАЛОГОВ)</h2>
<h3 id="определение-1">📖 ОПРЕДЕЛЕНИЕ</h3>
<p><strong>Directory Tree Mirroring</strong> — это алгоритм, при котором
исходная иерархия папок копируется с сохранением структуры, но с
модификацией (добавлением суффикса) только для корневых директорий.</p>
<p><strong>Технически:</strong> Процесс рекурсивного обхода файловой
системы и создания параллельной структуры, где каждый путь
трансформируется по правилу: <code>путь/к/папке</code> →
<code>путь/к/папке - суффикс/остаток/пути</code>.</p>
<h3 id="графический-рисунок-1">🎨 ГРАФИЧЕСКИЙ РИСУНОК</h3>
<pre><code>ИСХОДНАЯ СТРУКТУРА                 ЗЕРКАЛЬНАЯ СТРУКТУРА (суффикс &quot; - docx&quot;)
─────────────────────────────────────────────────────────────────
02_md_docx_мддок/                  02_md_docx_мддок/
│                                   │
├── файл.md                         ├── файл.docx
│                                   │
├── ПапкаА/                         ├── ПапкаА - docx/
│   ├── файл1.md                    │   ├── файл1.docx
│   └── Подпапка/                    │   └── Подпапка/
│       └── файл2.md                  │       └── файл2.docx
│                                   │
└── ПапкаБ/                         └── ПапкаБ - docx/
    └── файл3.md                         └── файл3.docx

ПРАВИЛО:
┌─────────────────────────────────────────────────────┐
│ Корневые файлы → сохраняются РЯДОМ                  │
│ Файлы в папках → папка получает суффикс,            │
│                  внутренняя структура сохраняется    │
└─────────────────────────────────────────────────────┘</code></pre>
<h3 id="скрипт-для-termux-1">💻 СКРИПТ ДЛЯ TERMUX</h3>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/data/data/com.termux/files/usr/bin/bash</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: mirror_demo.sh</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация Directory Tree Mirroring</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Цвета</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">GREEN</span><span class="op">=</span><span class="st">&#39;\033[0;32m&#39;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="va">BLUE</span><span class="op">=</span><span class="st">&#39;\033[0;34m&#39;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">YELLOW</span><span class="op">=</span><span class="st">&#39;\033[1;33m&#39;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="va">RED</span><span class="op">=</span><span class="st">&#39;\033[0;31m&#39;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="va">NC</span><span class="op">=</span><span class="st">&#39;\033[0m&#39;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">══════════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">   ДЕМОНСТРАЦИЯ DIRECTORY TREE MIRRORING</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">══════════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Конфигурация</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="va">WORK_DIR</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2&quot;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="va">INPUT_EXT</span><span class="op">=</span><span class="st">&quot;md&quot;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="va">OUTPUT_EXT</span><span class="op">=</span><span class="st">&quot;fb2&quot;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="va">FOLDER_SUFFIX</span><span class="op">=</span><span class="st">&quot; - </span><span class="va">${OUTPUT_EXT}</span><span class="st">&quot;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">Рабочая папка:</span><span class="va">${NC}</span><span class="st"> </span><span class="va">$WORK_DIR</span><span class="st">&quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">Суффикс:</span><span class="va">${NC}</span><span class="st"> </span><span class="va">$FOLDER_SUFFIX</span><span class="st">\n&quot;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Создаём тестовую структуру (для демонстрации)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">create_test_structure()</span> <span class="kw">{</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">&quot;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаА/Подпапка&quot;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаБ&quot;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;# Тестовый файл&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/корневой.md&quot;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;# Тестовый файл&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаА/файл1.md&quot;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;# Тестовый файл&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаА/Подпапка/файл2.md&quot;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;# Тестовый файл&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаБ/файл3.md&quot;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">✅ Создана тестовая структура</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Очистка тестовой структуры</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">clean_test_structure()</span> <span class="kw">{</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-rf</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаА&quot;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/ПапкаБ&quot;</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/корневой.md&quot;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-rf</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">&quot;</span>/<span class="pp">*</span><span class="st">&quot;</span><span class="va">$FOLDER_SUFFIX</span><span class="st">&quot;</span><span class="pp">*</span> <span class="dv">2</span><span class="op">&gt;</span>/dev/null</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">🧹 Тестовая структура очищена</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Основная функция зеркалирования</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">mirror_files()</span> <span class="kw">{</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">files_found</span><span class="op">=</span>0</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">files_mirrored</span><span class="op">=</span>0</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">🔍 Поиск файлов .</span><span class="va">$INPUT_EXT</span><span class="st">...</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">find</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">&quot;</span> <span class="at">-type</span> f <span class="at">-name</span> <span class="st">&quot;*.</span><span class="va">$INPUT_EXT</span><span class="st">&quot;</span> <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">full_path</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Пропускаем уже обработанные (idempotency)</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$full_path</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="pp">*</span><span class="st">&quot;</span><span class="va">$FOLDER_SUFFIX</span><span class="st">/&quot;</span><span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>        <span class="va">files_found</span><span class="op">=</span><span class="va">$((files_found</span> <span class="op">+</span> <span class="dv">1</span><span class="va">))</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        <span class="va">filename</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$full_path</span><span class="st">&quot;</span> <span class="st">&quot;.</span><span class="va">$INPUT_EXT</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        <span class="va">file_dir</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$full_path</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">[</span><span class="va">$files_found</span><span class="st">]</span><span class="va">${NC}</span><span class="st"> </span><span class="va">$filename</span><span class="st">.</span><span class="va">$INPUT_EXT</span><span class="st">&quot;</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ===== ЗЕРКАЛЬНАЯ ЛОГИКА =====</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$file_dir</span><span class="st">&quot;</span> <span class="ot">=</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Случай 1: файл в корне</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>            <span class="va">output_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$file_dir</span><span class="st">&quot;</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;   └─ 📍 Корневой → сохраняю рядом&quot;</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Случай 2: файл в папке</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>            <span class="va">rel_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${file_dir</span><span class="op">#</span><span class="va">$WORK_DIR</span>/<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>            <span class="va">top_folder</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${rel_path</span><span class="op">%%</span>/<span class="pp">*</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>            <span class="va">sub_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${rel_path</span><span class="op">#</span><span class="va">$top_folder}</span><span class="st">&quot;</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Создаём зеркальную папку</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>            <span class="va">target_folder</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">/</span><span class="va">${top_folder}${FOLDER_SUFFIX}${sub_path}</span><span class="st">&quot;</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$target_folder</span><span class="st">&quot;</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>            <span class="va">output_dir</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$target_folder</span><span class="st">&quot;</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;   └─ 🔄 Зеркало: </span><span class="va">${top_folder}${FOLDER_SUFFIX}${sub_path}</span><span class="st">/&quot;</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>        <span class="va">output_file</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$output_dir</span><span class="st">/</span><span class="va">$filename</span><span class="st">.</span><span class="va">$OUTPUT_EXT</span><span class="st">&quot;</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Имитация конвертации (создаём пустой файл)</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">touch</span> <span class="st">&quot;</span><span class="va">$output_file</span><span class="st">&quot;</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;      ✅ Создан: </span><span class="va">$filename</span><span class="st">.</span><span class="va">$OUTPUT_EXT</span><span class="st">&quot;</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>        <span class="va">files_mirrored</span><span class="op">=</span><span class="va">$((files_mirrored</span> <span class="op">+</span> <span class="dv">1</span><span class="va">))</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${GREEN}</span><span class="st">✅ Зеркалирование завершено</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;   Найдено файлов: </span><span class="va">$files_found</span><span class="st">&quot;</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;   Обработано: </span><span class="va">$files_mirrored</span><span class="st">&quot;</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Показать структуру</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="fu">show_structure()</span> <span class="kw">{</span></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">📁 ТЕКУЩАЯ СТРУКТУРА:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ls</span> <span class="at">-R</span> <span class="st">&quot;</span><span class="va">$WORK_DIR</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-20</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Запуск демонстрации</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="ex">clean_test_structure</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="ex">create_test_structure</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a><span class="ex">show_structure</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;&quot;</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a><span class="ex">mirror_files</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a><span class="ex">show_structure</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">══════════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">✨ Демонстрация завершена</span><span class="va">${NC}</span><span class="st">&quot;</span></span></code></pre></div>
<h3 id="скрипт-для-pydroid-3-1">🐍 СКРИПТ ДЛЯ PYDROID 3</h3>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: mirror_demo.py</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация Directory Tree Mirroring на Python</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Colors:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    GREEN <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[92m&#39;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    BLUE <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[94m&#39;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    YELLOW <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[93m&#39;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    RED <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[91m&#39;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    NC <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[0m&#39;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_color(text, color):</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>color<span class="sc">}{</span>text<span class="sc">}{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DirectoryMirror:</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, work_dir, input_ext, output_ext):</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.work_dir <span class="op">=</span> Path(work_dir)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.input_ext <span class="op">=</span> input_ext</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_ext <span class="op">=</span> output_ext</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.suffix <span class="op">=</span> <span class="ss">f&quot; - </span><span class="sc">{</span>output_ext<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.files_found <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.files_mirrored <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> create_test_structure(<span class="va">self</span>):</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Создание тестовой структуры папок&quot;&quot;&quot;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        os.makedirs(<span class="va">self</span>.work_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        os.makedirs(<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;Подпапка&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        os.makedirs(<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;ПапкаБ&quot;</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Создаём тестовые файлы</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        (<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;корневой.md&quot;</span>).write_text(<span class="st">&quot;# Тестовый файл&quot;</span>)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        (<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;файл1.md&quot;</span>).write_text(<span class="st">&quot;# Тестовый файл&quot;</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        (<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;Подпапка&quot;</span> <span class="op">/</span> <span class="st">&quot;файл2.md&quot;</span>).write_text(<span class="st">&quot;# Тестовый файл&quot;</span>)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        (<span class="va">self</span>.work_dir <span class="op">/</span> <span class="st">&quot;ПапкаБ&quot;</span> <span class="op">/</span> <span class="st">&quot;файл3.md&quot;</span>).write_text(<span class="st">&quot;# Тестовый файл&quot;</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="st">&quot;✅ Создана тестовая структура&quot;</span>, Colors.GREEN)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_test_structure(<span class="va">self</span>):</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Очистка тестовой структуры&quot;&quot;&quot;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item <span class="kw">in</span> <span class="va">self</span>.work_dir.iterdir():</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> item.is_dir():</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> item.name <span class="kw">in</span> [<span class="st">&quot;ПапкаА&quot;</span>, <span class="st">&quot;ПапкаБ&quot;</span>] <span class="kw">or</span> <span class="va">self</span>.suffix <span class="kw">in</span> item.name:</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                    shutil.rmtree(item)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> item.name <span class="op">!=</span> <span class="st">&quot;корневой.md&quot;</span>:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>                    item.unlink()</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="st">&quot;🧹 Тестовая структура очищена&quot;</span>, Colors.YELLOW)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> get_target_path(<span class="va">self</span>, file_path):</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Определение целевого пути для файла&quot;&quot;&quot;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> Path(file_path)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        file_dir <span class="op">=</span> file_path.parent</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> file_dir <span class="op">==</span> <span class="va">self</span>.work_dir:</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Случай 1: файл в корне</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> file_dir</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Случай 2: файл в папке</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        rel_path <span class="op">=</span> <span class="bu">str</span>(file_dir.relative_to(<span class="va">self</span>.work_dir))</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        parts <span class="op">=</span> rel_path.split(os.sep)</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        top_folder <span class="op">=</span> parts[<span class="dv">0</span>]</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        sub_path <span class="op">=</span> os.sep.join(parts[<span class="dv">1</span>:]) <span class="cf">if</span> <span class="bu">len</span>(parts) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Формируем зеркальный путь</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        target <span class="op">=</span> <span class="va">self</span>.work_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>top_folder<span class="sc">}{</span><span class="va">self</span><span class="sc">.</span>suffix<span class="sc">}</span><span class="ss">&quot;</span> <span class="op">/</span> sub_path</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> target</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> mirror_files(<span class="va">self</span>):</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Основная функция зеркалирования&quot;&quot;&quot;</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔍 Поиск файлов .</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>input_ext<span class="sc">}</span><span class="ss">...</span><span class="ch">\n</span><span class="ss">&quot;</span>, Colors.BLUE)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> full_path <span class="kw">in</span> <span class="va">self</span>.work_dir.rglob(<span class="ss">f&quot;*.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>input_ext<span class="sc">}</span><span class="ss">&quot;</span>):</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Пропускаем уже обработанные (idempotency)</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.suffix <span class="kw">in</span> <span class="bu">str</span>(full_path):</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.files_found <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> full_path.stem</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;[</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>files_found<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>input_ext<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Получаем целевой путь</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>            target_dir <span class="op">=</span> <span class="va">self</span>.get_target_path(full_path)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>            os.makedirs(target_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Определяем, корневой это файл или нет</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> full_path.parent <span class="op">==</span> <span class="va">self</span>.work_dir:</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   └─ 📍 Корневой → сохраняю рядом&quot;</span>)</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>                rel_to_work <span class="op">=</span> <span class="bu">str</span>(full_path.parent.relative_to(<span class="va">self</span>.work_dir))</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   └─ 🔄 Зеркало: </span><span class="sc">{</span>rel_to_work<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>target_dir<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Создаём выходной файл (имитация конвертации)</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>            output_file <span class="op">=</span> target_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>output_ext<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>            output_file.touch()</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;      ✅ Создан: </span><span class="sc">{</span>output_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.files_mirrored <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">✅ Зеркалирование завершено&quot;</span>, Colors.GREEN)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   Найдено файлов: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>files_found<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;   Обработано: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>files_mirrored<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> show_structure(<span class="va">self</span>, lines<span class="op">=</span><span class="dv">20</span>):</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Показать структуру папок&quot;&quot;&quot;</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">📁 ТЕКУЩАЯ СТРУКТУРА:&quot;</span>, Colors.BLUE)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(<span class="va">self</span>.work_dir):</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>            level <span class="op">=</span> root.replace(<span class="bu">str</span>(<span class="va">self</span>.work_dir), <span class="st">&#39;&#39;</span>).count(os.sep)</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>            indent <span class="op">=</span> <span class="st">&#39; &#39;</span> <span class="op">*</span> <span class="dv">4</span> <span class="op">*</span> level</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>indent<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>basename(root)<span class="sc">}</span><span class="ss">/&quot;</span>)</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>            subindent <span class="op">=</span> <span class="st">&#39; &#39;</span> <span class="op">*</span> <span class="dv">4</span> <span class="op">*</span> (level <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files[:<span class="dv">5</span>]:  <span class="co"># Показываем первые 5 файлов</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>subindent<span class="sc">}{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>                count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> count <span class="op">&gt;</span> lines:</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>subindent<span class="sc">}</span><span class="ss">...&quot;</span>)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;══════════════════════════════════════════════&quot;</span>, Colors.BLUE)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;   ДЕМОНСТРАЦИЯ DIRECTORY TREE MIRRORING&quot;</span>, Colors.GREEN)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;══════════════════════════════════════════════</span><span class="ch">\n</span><span class="st">&quot;</span>, Colors.BLUE)</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Конфигурация</span></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    WORK_DIR <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2&quot;</span></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    mirror <span class="op">=</span> DirectoryMirror(WORK_DIR, <span class="st">&quot;md&quot;</span>, <span class="st">&quot;fb2&quot;</span>)</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Демонстрация</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>    mirror.clean_test_structure()</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    mirror.create_test_structure()</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>    mirror.show_structure()</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>    mirror.mirror_files()</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>    mirror.show_structure()</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">══════════════════════════════════════════════&quot;</span>, Colors.BLUE)</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;✨ Демонстрация завершена&quot;</span>, Colors.GREEN)</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>    main()</span></code></pre></div>
<hr />
<h2 id="idempotency-идемпотентность">3️⃣ IDEMPOTENCY
(ИДЕМПОТЕНТНОСТЬ)</h2>
<h3 id="определение-2">📖 ОПРЕДЕЛЕНИЕ</h3>
<p><strong>Idempotency</strong> — свойство операции, при котором
многократное её применение даёт тот же результат, что и однократное.
Скрипт можно запускать сколько угодно раз — он не создаст дубликатов, не
перезапишет нужные данные и не выдаст ошибок.</p>
<p><strong>Технически:</strong> Проверка существования перед созданием,
пропуск уже обработанных файлов, использование флагов <code>-f</code>,
<code>-d</code> для проверок.</p>
<h3 id="графический-рисунок-2">🎨 ГРАФИЧЕСКИЙ РИСУНОК</h3>
<pre><code>БЕЗ ИДЕМПОТЕНТНОСТИ (ПЛОХО):
┌─────────────────────────────────────────────────────┐
│ Запуск 1: mkdir папка     → папка создана           │
│ Запуск 2: mkdir папка     → ОШИБКА: уже существует  │
│ Запуск 3: cp file file2   → второй дубликат         │
└─────────────────────────────────────────────────────┘

С ИДЕМПОТЕНТНОСТЬЮ (ХОРОШО):
┌─────────────────────────────────────────────────────┐
│ Запуск 1: mkdir -p папка  → папка создана           │
│ Запуск 2: mkdir -p папка  → тихо, ошибки нет        │
│ Запуск 3: [ -f file2 ] || cp file file2 → один файл │
└─────────────────────────────────────────────────────┘

ПРОВЕРКИ:
┌─────────────────────────────────────────────────────┐
│ [ -d &quot;папка&quot; ]    # проверка существования папки    │
│ [ -f &quot;файл&quot; ]     # проверка существования файла    │
│ [[ &quot;$path&quot; == *&quot;suffix&quot;* ]]  # проверка паттерна    │
└─────────────────────────────────────────────────────┘</code></pre>
<h3 id="скрипт-для-termux-2">💻 СКРИПТ ДЛЯ TERMUX</h3>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/data/data/com.termux/files/usr/bin/bash</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: idempotency_demo.sh</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация идемпотентности</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="va">GREEN</span><span class="op">=</span><span class="st">&#39;\033[0;32m&#39;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="va">BLUE</span><span class="op">=</span><span class="st">&#39;\033[0;34m&#39;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="va">YELLOW</span><span class="op">=</span><span class="st">&#39;\033[1;33m&#39;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="va">RED</span><span class="op">=</span><span class="st">&#39;\033[0;31m&#39;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="va">NC</span><span class="op">=</span><span class="st">&#39;\033[0m&#39;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">   ДЕМОНСТРАЦИЯ ИДЕМПОТЕНТНОСТИ</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрационная папка</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="va">DEMO_DIR</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/idempotency_demo&quot;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">&quot;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">&quot;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">Демонстрационная папка:</span><span class="va">${NC}</span><span class="st"> </span><span class="va">$DEMO_DIR</span><span class="st">\n&quot;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ПРИМЕР 1: СОЗДАНИЕ ПАПОК =====</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">ПРИМЕР 1: Создание папок</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># НЕИДЕМПОТЕНТНО (плохо)</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${RED}</span><span class="st">❌ НЕИДЕМПОТЕНТНО:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   mkdir test_folder&quot;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> test_folder <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;   ✅ Папка создана&quot;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   mkdir test_folder (снова)&quot;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> test_folder <span class="dv">2</span><span class="op">&gt;</span>/dev/null <span class="kw">||</span> <span class="bu">echo</span> <span class="st">&quot;   ❌ ОШИБКА: папка уже существует&quot;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ИДЕМПОТЕНТНО (хорошо)</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${GREEN}</span><span class="st">✅ ИДЕМПОТЕНТНО:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   mkdir -p test_folder2&quot;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> test_folder2 <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;   ✅ Папка создана или уже существует&quot;</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   mkdir -p test_folder2 (снова)&quot;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> test_folder2 <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;   ✅ Второй запуск - ошибки нет&quot;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ПРИМЕР 2: КОПИРОВАНИЕ ФАЙЛОВ =====</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">ПРИМЕР 2: Копирование файлов</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Тестовый контент&quot;</span> <span class="op">&gt;</span> source.txt</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co"># НЕИДЕМПОТЕНТНО</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${RED}</span><span class="st">❌ НЕИДЕМПОТЕНТНО:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> source.txt dest1.txt <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;   ✅ Файл скопирован&quot;</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> source.txt dest1.txt <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;   ✅ Файл скопирован (снова - создан дубликат?)&quot;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   🚨 Содержимое dest1.txt перезаписано, но файл один&quot;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co"># ИДЕМПОТЕНТНО (с проверкой)</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${GREEN}</span><span class="st">✅ ИДЕМПОТЕНТНО:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;dest2.txt&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cp</span> source.txt dest2.txt</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;   ✅ Файл скопирован (первый раз)&quot;</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;   ⏭️ Файл уже существует, пропускаем&quot;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;dest2.txt&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cp</span> source.txt dest2.txt</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;   ⏭️ Второй запуск - файл уже есть, пропускаем&quot;</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ПРИМЕР 3: ЗАЩИТА ОТ ПОВТОРНОЙ ОБРАБОТКИ =====</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">ПРИМЕР 3: Защита от повторной обработки</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Создаём структуру для демонстрации</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;source/Папка&quot;</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;processed/Папка - docx&quot;</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;файл1&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;source/файл1.md&quot;</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;файл2&quot;</span> <span class="op">&gt;</span> <span class="st">&quot;source/Папка/файл2.md&quot;</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> <span class="st">&quot;processed/Папка - docx/файл2.docx&quot;</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="fu">process_files()</span> <span class="kw">{</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">files_found</span><span class="op">=</span>0</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="bu">local</span> <span class="va">files_processed</span><span class="op">=</span>0</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">find</span> <span class="st">&quot;source&quot;</span> <span class="at">-type</span> f <span class="at">-name</span> <span class="st">&quot;*.md&quot;</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="at">-r</span> <span class="va">file</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ИДЕМПОТЕНТНАЯ ПРОВЕРКА</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">[[</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="pp">*</span><span class="st">&quot; - docx/&quot;</span><span class="pp">*</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;   ⏭️ Пропускаем уже обработанный: </span><span class="va">$file</span><span class="st">&quot;</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        <span class="va">files_found</span><span class="op">=</span><span class="va">$((files_found</span> <span class="op">+</span> <span class="dv">1</span><span class="va">))</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        <span class="va">filename</span><span class="op">=</span><span class="va">$(</span><span class="fu">basename</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span> .md<span class="va">)</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>        <span class="va">filedir</span><span class="op">=</span><span class="va">$(</span><span class="fu">dirname</span> <span class="st">&quot;</span><span class="va">$file</span><span class="st">&quot;</span><span class="va">)</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="st">&quot;   📄 Найден: </span><span class="va">$filename</span><span class="st">.md&quot;</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Определяем целевую папку</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$filedir</span><span class="st">&quot;</span> <span class="ot">=</span> <span class="st">&quot;source&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>            <span class="va">target</span><span class="op">=</span><span class="st">&quot;processed&quot;</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>            <span class="va">rel_path</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${filedir</span><span class="op">#</span>source/<span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>            <span class="va">top_folder</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${rel_path</span><span class="op">%%</span>/<span class="pp">*</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>            <span class="va">target</span><span class="op">=</span><span class="st">&quot;processed/</span><span class="va">${top_folder}</span><span class="st"> - docx&quot;</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$target</span><span class="st">&quot;</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="va">output</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$target</span><span class="st">/</span><span class="va">$filename</span><span class="st">.docx&quot;</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ИДЕМПОТЕНТНАЯ ПРОВЕРКА</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">&quot;</span><span class="va">$output</span><span class="st">&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>            <span class="fu">touch</span> <span class="st">&quot;</span><span class="va">$output</span><span class="st">&quot;</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;      ✅ Создан: </span><span class="va">$filename</span><span class="st">.docx&quot;</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>            <span class="va">files_processed</span><span class="op">=</span><span class="va">$((files_processed</span> <span class="op">+</span> <span class="dv">1</span><span class="va">))</span></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">echo</span> <span class="st">&quot;      ⏭️ Уже существует: </span><span class="va">$filename</span><span class="st">.docx&quot;</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n   📊 Найдено: </span><span class="va">$files_found</span><span class="st">, Обработано: </span><span class="va">$files_processed</span><span class="st">&quot;</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${YELLOW}</span><span class="st">Запуск 1:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="ex">process_files</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${YELLOW}</span><span class="st">Запуск 2 (тот же самый):</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="ex">process_files</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ПРИМЕР 4: ПРАКТИЧЕСКИЕ ПРОВЕРКИ =====</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">ПРИМЕР 4: Полезные идемпотентные конструкции</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">/idempotent_functions.sh&quot;</span> <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентное создание папки</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="st">safe_mkdir() {</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a><span class="st">    mkdir -p &quot;$1&quot; &amp;&amp; echo &quot;✅ Папка $1 готова&quot;</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентное копирование</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a><span class="st">safe_copy() {</span></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ ! -f &quot;$2&quot; ]; then</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a><span class="st">        cp &quot;$1&quot; &quot;$2&quot; &amp;&amp; echo &quot;✅ Файл скопирован в $2&quot;</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="st">    else</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;⏭️ Файл $2 уже существует, пропускаем&quot;</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентная запись в файл (не перезаписывать)</span></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="st">safe_append() {</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a><span class="st">    if ! grep -q &quot;$2&quot; &quot;$1&quot; 2&gt;/dev/null; then</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;$2&quot; &gt;&gt; &quot;$1&quot;</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;✅ Строка добавлена&quot;</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a><span class="st">    else</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;⏭️ Строка уже есть в файле&quot;</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a><span class="st"># Проверка на уже обработанные пути</span></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a><span class="st">is_processed() {</span></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a><span class="st">    [[ &quot;$1&quot; == *&quot; - docx/&quot;* ]] || [[ &quot;$1&quot; == *&quot; - fb2/&quot;* ]]</span></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентное создание структуры</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a><span class="st">safe_mirror() {</span></span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a><span class="st">    local source_file=&quot;$1&quot;</span></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a><span class="st">    local target_dir=&quot;$2&quot;</span></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a><span class="st">    if is_processed &quot;$source_file&quot;; then</span></span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;⏭️ Пропускаем обработанный файл&quot;</span></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a><span class="st">        return 0</span></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ ! -d &quot;$target_dir&quot; ]; then</span></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a><span class="st">        mkdir -p &quot;$target_dir&quot;</span></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;✅ Создана папка: $target_dir&quot;</span></span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ ! -f &quot;$target_dir/$(basename &quot;$source_file&quot;)&quot; ]; then</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a><span class="st">        cp &quot;$source_file&quot; &quot;$target_dir/&quot;</span></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;✅ Файл скопирован&quot;</span></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x idempotent_functions.sh</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">✅ Создан файл с идемпотентными функциями</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ПРИМЕР 5: ПРАКТИКА С TERMUX =====</span></span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">ПРИМЕР 5: Практика для Termux (Pandoc)</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">/idempotent_pandoc.sh&quot;</span> <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a><span class="st">#!/data/data/com.termux/files/usr/bin/bash</span></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентная конвертация с Pandoc</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a><span class="st">WORK_DIR=&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2&quot;</span></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a><span class="st">INPUT_EXT=&quot;md&quot;</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a><span class="st">OUTPUT_EXT=&quot;fb2&quot;</span></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="st">FOLDER_SUFFIX=&quot; - ${OUTPUT_EXT}&quot;</span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a><span class="st"># Идемпотентная конвертация</span></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a><span class="st">convert_if_needed() {</span></span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a><span class="st">    local md_file=&quot;$1&quot;</span></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a><span class="st">    local fb2_file=&quot;$2&quot;</span></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a><span class="st">    # Проверка 1: не обрабатываем уже обработанное</span></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a><span class="st">    if [[ &quot;$md_file&quot; == *&quot;$FOLDER_SUFFIX/&quot;* ]]; then</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;⏭️ Пропускаем: файл в папке с результатами&quot;</span></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a><span class="st">        return 0</span></span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a><span class="st">    # Проверка 2: существует ли исходный файл</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ ! -f &quot;$md_file&quot; ]; then</span></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;❌ Ошибка: исходный файл не найден&quot;</span></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a><span class="st">        return 1</span></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a><span class="st">    # Проверка 3: нужно ли конвертировать (файл новее результата)</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ -f &quot;$fb2_file&quot; ]; then</span></span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a><span class="st">        if [ &quot;$md_file&quot; -ot &quot;$fb2_file&quot; ]; then</span></span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a><span class="st">            echo &quot;⏭️ Результат свежее исходника, пропускаем&quot;</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a><span class="st">            return 0</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a><span class="st">        fi</span></span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a><span class="st">    # Создаём папку, если нужно</span></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a><span class="st">    mkdir -p &quot;$(dirname &quot;$fb2_file&quot;)&quot;</span></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a><span class="st">    # Конвертируем</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a><span class="st">    echo &quot;⚙️ Конвертирую: $(basename &quot;$md_file&quot;)&quot;</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="st">    pandoc &quot;$md_file&quot; -o &quot;$fb2_file&quot; 2&gt;/dev/null</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ $? -eq 0 ]; then</span></span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;✅ Готово: $(basename &quot;$fb2_file&quot;)&quot;</span></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a><span class="st">        return 0</span></span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a><span class="st">    else</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="st">        echo &quot;❌ Ошибка конвертации&quot;</span></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a><span class="st">        return 1</span></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a><span class="st"># Пример использования</span></span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a><span class="st">find &quot;$WORK_DIR&quot; -name &quot;*.md&quot; | while read -r file; do</span></span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a><span class="st">    filename=$(basename &quot;$file&quot; .md)</span></span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a><span class="st">    filedir=$(dirname &quot;$file&quot;)</span></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a><span class="st">    if [ &quot;$filedir&quot; = &quot;$WORK_DIR&quot; ]; then</span></span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a><span class="st">        # Корневой файл</span></span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a><span class="st">        output=&quot;$WORK_DIR/$filename.$OUTPUT_EXT&quot;</span></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a><span class="st">    else</span></span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a><span class="st">        # Файл в папке</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a><span class="st">        rel_path=&quot;${filedir#$WORK_DIR/}&quot;</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="st">        top_folder=&quot;${rel_path%%/*}&quot;</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a><span class="st">        sub_path=&quot;${rel_path#$top_folder}&quot;</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a><span class="st">        output=&quot;$WORK_DIR/${top_folder}${FOLDER_SUFFIX}${sub_path}/$filename.$OUTPUT_EXT&quot;</span></span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a><span class="st">    fi</span></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="st">    convert_if_needed &quot;$file&quot; &quot;$output&quot;</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a><span class="st">done</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x idempotent_pandoc.sh</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">✅ Создан идемпотентный скрипт для Pandoc</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;\n</span><span class="va">${BLUE}</span><span class="st">════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">✨ Демонстрация идемпотентности завершена</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">💡 Функции сохранены в:</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">$DEMO_DIR</span><span class="st">/idempotent_functions.sh&quot;</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;   </span><span class="va">$DEMO_DIR</span><span class="st">/idempotent_pandoc.sh&quot;</span></span></code></pre></div>
<h3 id="скрипт-для-pydroid-3-2">🐍 СКРИПТ ДЛЯ PYDROID 3</h3>
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: idempotency_demo.py</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация идемпотентности в Python</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> hashlib</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Colors:</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    GREEN <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[92m&#39;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    BLUE <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[94m&#39;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    YELLOW <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[93m&#39;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    RED <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[91m&#39;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    NC <span class="op">=</span> <span class="st">&#39;</span><span class="ch">\033</span><span class="st">[0m&#39;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_color(text, color):</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{</span>color<span class="sc">}{</span>text<span class="sc">}{</span>Colors<span class="sc">.</span>NC<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> IdempotentOperations:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Класс с идемпотентными операциями&quot;&quot;&quot;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, base_dir):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.base_dir <span class="op">=</span> Path(base_dir)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.base_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processed_files <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.load_state()</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> load_state(<span class="va">self</span>):</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Загрузка состояния из файла (идемпотентность между запусками)&quot;&quot;&quot;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        state_file <span class="op">=</span> <span class="va">self</span>.base_dir <span class="op">/</span> <span class="st">&quot;.processed.log&quot;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> state_file.exists():</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(state_file, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.processed_files <span class="op">=</span> <span class="bu">set</span>(line.strip() <span class="cf">for</span> line <span class="kw">in</span> f)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_state(<span class="va">self</span>, file_path):</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Сохранение состояния&quot;&quot;&quot;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        state_file <span class="op">=</span> <span class="va">self</span>.base_dir <span class="op">/</span> <span class="st">&quot;.processed.log&quot;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(state_file, <span class="st">&#39;a&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="ss">f&quot;</span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ch">\n</span><span class="ss">&quot;</span>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.processed_files.add(file_path)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> safe_mkdir(<span class="va">self</span>, path):</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Идемпотентное создание папки&quot;&quot;&quot;</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> Path(path)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> path.exists():</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            path.mkdir(parents<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ✅ Папка создана: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>, Colors.GREEN)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ⏭️ Папка уже существует: </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> path</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> safe_copy(<span class="va">self</span>, src, dst, check_hash<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Идемпотентное копирование&quot;&quot;&quot;</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>        src <span class="op">=</span> Path(src)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        dst <span class="op">=</span> Path(dst)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Проверка существования исходного файла</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> src.exists():</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ❌ Исходный файл не найден: </span><span class="sc">{</span>src<span class="sc">}</span><span class="ss">&quot;</span>, Colors.RED)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Проверка существования целевого файла</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dst.exists():</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> check_hash:</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Сравниваем хеши</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="va">self</span>.file_hash(src) <span class="op">==</span> <span class="va">self</span>.file_hash(dst):</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>                    print_color(<span class="ss">f&quot;   ⏭️ Файл уже существует и идентичен: </span><span class="sc">{</span>dst<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>                    print_color(<span class="ss">f&quot;   ⚠️ Файл существует, но отличается. Перезапись?&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Здесь можно спросить пользователя или добавить флаг</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>                print_color(<span class="ss">f&quot;   ⏭️ Файл уже существует: </span><span class="sc">{</span>dst<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Копируем</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>        shutil.copy2(src, dst)</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>        print_color(<span class="ss">f&quot;   ✅ Скопировано: </span><span class="sc">{</span>src<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> → </span><span class="sc">{</span>dst<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.GREEN)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> file_hash(<span class="va">self</span>, file_path):</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Вычисление хеша файла для сравнения&quot;&quot;&quot;</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>        hasher <span class="op">=</span> hashlib.md5()</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">&#39;rb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> <span class="bu">iter</span>(<span class="kw">lambda</span>: f.read(<span class="dv">4096</span>), <span class="st">b&#39;&#39;</span>):</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>                hasher.update(chunk)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> hasher.hexdigest()</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> safe_write(<span class="va">self</span>, file_path, content, mode<span class="op">=</span><span class="st">&#39;append&#39;</span>):</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Идемпотентная запись в файл&quot;&quot;&quot;</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> Path(file_path)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mode <span class="op">==</span> <span class="st">&#39;append&#39;</span>:</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Проверяем, есть ли уже такая строка</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> file_path.exists():</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> content <span class="kw">in</span> f.read():</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>                        print_color(<span class="ss">f&quot;   ⏭️ Строка уже есть в файле&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Добавляем строку</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">&#39;a&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>                f.write(content <span class="op">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ✅ Строка добавлена&quot;</span>, Colors.GREEN)</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> mode <span class="op">==</span> <span class="st">&#39;overwrite&#39;</span>:</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Перезаписываем только если контент отличается</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> file_path.exists():</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>                <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> f.read() <span class="op">==</span> content:</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>                        print_color(<span class="ss">f&quot;   ⏭️ Файл уже содержит такой же контент&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>            <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>                f.write(content)</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ✅ Файл записан&quot;</span>, Colors.GREEN)</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> safe_process_file(<span class="va">self</span>, file_path, processor_func):</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Идемпотентная обработка файла&quot;&quot;&quot;</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>        file_path <span class="op">=</span> Path(file_path)</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Проверка: не обработан ли уже</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(file_path) <span class="kw">in</span> <span class="va">self</span>.processed_files:</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ⏭️ Файл уже обработан в этой сессии: </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Проверка: существует ли файл</span></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> file_path.exists():</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ❌ Файл не найден: </span><span class="sc">{</span>file_path<span class="sc">}</span><span class="ss">&quot;</span>, Colors.RED)</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Обработка</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> processor_func(file_path)</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> result:</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.save_state(<span class="bu">str</span>(file_path))</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>                print_color(<span class="ss">f&quot;   ✅ Файл обработан: </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.GREEN)</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> result</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ❌ Ошибка обработки: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">&quot;</span>, Colors.RED)</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_processed_path(<span class="va">self</span>, path, suffix_list<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Проверка, не является ли путь уже обработанным&quot;&quot;&quot;</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> suffix_list <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>            suffix_list <span class="op">=</span> [<span class="st">&quot; - docx&quot;</span>, <span class="st">&quot; - fb2&quot;</span>, <span class="st">&quot; - html&quot;</span>]</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>        path_str <span class="op">=</span> <span class="bu">str</span>(path)</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> suffix <span class="kw">in</span> suffix_list:</span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> suffix <span class="kw">in</span> path_str:</span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> demo_idempotency():</span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Демонстрация идемпотентности&quot;&quot;&quot;</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;════════════════════════════════════════&quot;</span>, Colors.BLUE)</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;   ДЕМОНСТРАЦИЯ ИДЕМПОТЕНТНОСТИ (Python)&quot;</span>, Colors.GREEN)</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;════════════════════════════════════════</span><span class="ch">\n</span><span class="st">&quot;</span>, Colors.BLUE)</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Создаём рабочую папку</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>    demo_dir <span class="op">=</span> <span class="st">&quot;/storage/emulated/0/Documents/idempotency_demo&quot;</span></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>    ops <span class="op">=</span> IdempotentOperations(demo_dir)</span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 1: ИДЕМПОТЕНТНОЕ СОЗДАНИЕ ПАПОК =====</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 1: Создание папок&quot;</span>, Colors.BLUE)</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">❌ НЕИДЕМПОТЕНТНО (плохо):&quot;</span>, Colors.RED)</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>        os.mkdir(<span class="ss">f&quot;</span><span class="sc">{</span>demo_dir<span class="sc">}</span><span class="ss">/test_folder&quot;</span>)</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;   ✅ Папка создана&quot;</span>)</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>        os.mkdir(<span class="ss">f&quot;</span><span class="sc">{</span>demo_dir<span class="sc">}</span><span class="ss">/test_folder&quot;</span>)  <span class="co"># Второй раз - ошибка!</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileExistsError</span>:</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;   ❌ ОШИБКА: папка уже существует&quot;</span>)</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">✅ ИДЕМПОТЕНТНО (хорошо):&quot;</span>, Colors.GREEN)</span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>    ops.safe_mkdir(<span class="ss">f&quot;</span><span class="sc">{</span>demo_dir<span class="sc">}</span><span class="ss">/test_folder2&quot;</span>)</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>    ops.safe_mkdir(<span class="ss">f&quot;</span><span class="sc">{</span>demo_dir<span class="sc">}</span><span class="ss">/test_folder2&quot;</span>)  <span class="co"># Второй раз - без ошибки</span></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 2: ИДЕМПОТЕНТНОЕ КОПИРОВАНИЕ =====</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 2: Копирование файлов&quot;</span>, Colors.BLUE)</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Создаём тестовый файл</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>    source <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;source.txt&quot;</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(source, <span class="st">&#39;w&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>        f.write(<span class="st">&quot;Тестовый контент&quot;</span>)</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">❌ НЕИДЕМПОТЕНТНО:&quot;</span>, Colors.RED)</span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>    dest1 <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;dest1.txt&quot;</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>    shutil.copy(source, dest1)</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;   ✅ Файл скопирован (раз)&quot;</span>)</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>    shutil.copy(source, dest1)  <span class="co"># Перезаписывает</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;   ✅ Файл скопирован (два - перезаписан)&quot;</span>)</span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">✅ ИДЕМПОТЕНТНО:&quot;</span>, Colors.GREEN)</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>    dest2 <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;dest2.txt&quot;</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>    ops.safe_copy(source, dest2)</span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>    ops.safe_copy(source, dest2)  <span class="co"># Второй раз - пропускает</span></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 3: ИДЕМПОТЕНТНАЯ ЗАПИСЬ =====</span></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 3: Запись в файл&quot;</span>, Colors.BLUE)</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>    log_file <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;log.txt&quot;</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">✅ ИДЕМПОТЕНТНОЕ ДОБАВЛЕНИЕ:&quot;</span>, Colors.GREEN)</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>    ops.safe_write(log_file, <span class="st">&quot;Запись 1&quot;</span>, mode<span class="op">=</span><span class="st">&#39;append&#39;</span>)</span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>    ops.safe_write(log_file, <span class="st">&quot;Запись 1&quot;</span>, mode<span class="op">=</span><span class="st">&#39;append&#39;</span>)  <span class="co"># Дубль не добавится</span></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 4: ЗАЩИТА ОТ ПОВТОРНОЙ ОБРАБОТКИ =====</span></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 4: Защита от повторной обработки&quot;</span>, Colors.BLUE)</span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> process_file(file_path):</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;Функция обработки файла&quot;&quot;&quot;</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Имитация обработки</span></span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.1</span>)</span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Создаём тестовые файлы</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>    test_file <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;test.md&quot;</span></span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>    test_file.write_text(<span class="st">&quot;# Тестовый файл&quot;</span>)</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">✅ ИДЕМПОТЕНТНАЯ ОБРАБОТКА:&quot;</span>, Colors.GREEN)</span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>    ops.safe_process_file(test_file, process_file)</span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>    ops.safe_process_file(test_file, process_file)  <span class="co"># Второй раз пропустит</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 5: ПРОВЕРКА УЖЕ ОБРАБОТАННЫХ ПУТЕЙ =====</span></span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 5: Проверка обработанных путей&quot;</span>, Colors.BLUE)</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>    test_paths <span class="op">=</span> [</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/файл.md&quot;</span>,</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/Папка - fb2/файл.md&quot;</span>,</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;/storage/emulated/0/Documents/05_Элект_книги/02_md_fb2_мдфб2/Папка - docx/файл.md&quot;</span>,</span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> path <span class="kw">in</span> test_paths:</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ops.is_processed_path(path):</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ⏭️ Пропускаем (уже обработан): </span><span class="sc">{</span>Path(path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>            print_color(<span class="ss">f&quot;   ✅ Можно обрабатывать: </span><span class="sc">{</span>Path(path)<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>, Colors.GREEN)</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ===== ПРИМЕР 6: ПРАКТИЧЕСКИЙ - MIRRORING С ИДЕМПОТЕНТНОСТЬЮ =====</span></span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">📁 ПРИМЕР 6: Mirroring с идемпотентностью&quot;</span>, Colors.BLUE)</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> IdempotentMirror:</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, work_dir, input_ext, output_ext):</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.work_dir <span class="op">=</span> Path(work_dir)</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.input_ext <span class="op">=</span> input_ext</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_ext <span class="op">=</span> output_ext</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.suffix <span class="op">=</span> <span class="ss">f&quot; - </span><span class="sc">{</span>output_ext<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.ops <span class="op">=</span> IdempotentOperations(work_dir <span class="op">/</span> <span class="st">&quot;.state&quot;</span>)</span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> mirror_file(<span class="va">self</span>, file_path):</span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>            <span class="co">&quot;&quot;&quot;Зеркалирование одного файла с идемпотентностью&quot;&quot;&quot;</span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Проверка 1: не обрабатываем уже обработанное</span></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.ops.is_processed_path(file_path, [<span class="va">self</span>.suffix]):</span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   ⏭️ Пропускаем: </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss"> (уже в зеркальной папке)&quot;</span>)</span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> Path(file_path)</span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>            file_dir <span class="op">=</span> file_path.parent</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>            filename <span class="op">=</span> file_path.stem</span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Определяем целевой путь</span></span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> file_dir <span class="op">==</span> <span class="va">self</span>.work_dir:</span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>                target_dir <span class="op">=</span> <span class="va">self</span>.work_dir</span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   📍 Корневой файл&quot;</span>)</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>                rel_path <span class="op">=</span> <span class="bu">str</span>(file_dir.relative_to(<span class="va">self</span>.work_dir))</span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>                parts <span class="op">=</span> rel_path.split(os.sep)</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>                top_folder <span class="op">=</span> parts[<span class="dv">0</span>]</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a>                sub_path <span class="op">=</span> os.sep.join(parts[<span class="dv">1</span>:]) <span class="cf">if</span> <span class="bu">len</span>(parts) <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a>                target_dir <span class="op">=</span> <span class="va">self</span>.work_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>top_folder<span class="sc">}{</span><span class="va">self</span><span class="sc">.</span>suffix<span class="sc">}</span><span class="ss">&quot;</span> <span class="op">/</span> sub_path</span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;   🔄 Зеркало: </span><span class="sc">{</span>top_folder<span class="sc">}{</span><span class="va">self</span><span class="sc">.</span>suffix<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>sub_path<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Создаём папку (идемпотентно)</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a>            target_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Целевой файл</span></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>            target_file <span class="op">=</span> target_dir <span class="op">/</span> <span class="ss">f&quot;</span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>output_ext<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Проверка 2: существует ли уже результат</span></span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> target_file.exists():</span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Проверяем, не новее ли исходник</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> file_path.stat().st_mtime <span class="op">&lt;=</span> target_file.stat().st_mtime:</span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="ss">f&quot;   ⏭️ Результат уже существует и свежее&quot;</span>)</span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Имитация конвертации (создаём файл)</span></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>            target_file.write_text(<span class="ss">f&quot;# Сконвертировано из </span><span class="sc">{</span>file_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;   ✅ Создан: </span><span class="sc">{</span>target_file<span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> mirror_all(<span class="va">self</span>):</span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>            <span class="co">&quot;&quot;&quot;Зеркалирование всех файлов&quot;&quot;&quot;</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a>            files <span class="op">=</span> <span class="bu">list</span>(<span class="va">self</span>.work_dir.rglob(<span class="ss">f&quot;*.</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>input_ext<span class="sc">}</span><span class="ss">&quot;</span>))</span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">🔍 Найдено файлов: </span><span class="sc">{</span><span class="bu">len</span>(files)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i, <span class="bu">file</span> <span class="kw">in</span> <span class="bu">enumerate</span>(files, <span class="dv">1</span>):</span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="ch">\n</span><span class="ss">[</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span><span class="bu">file</span><span class="sc">.</span>name<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.mirror_file(<span class="bu">file</span>)</span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Создаём тестовую структуру</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a>    test_mirror_dir <span class="op">=</span> Path(demo_dir) <span class="op">/</span> <span class="st">&quot;mirror_test&quot;</span></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a>    test_mirror_dir.mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Создаём тестовые файлы</span></span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a>    (test_mirror_dir <span class="op">/</span> <span class="st">&quot;корневой.md&quot;</span>).write_text(<span class="st">&quot;# Корневой файл&quot;</span>)</span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>    (test_mirror_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span>).mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a>    (test_mirror_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;файл1.md&quot;</span>).write_text(<span class="st">&quot;# Файл в папке&quot;</span>)</span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>    (test_mirror_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;Подпапка&quot;</span>).mkdir(exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>    (test_mirror_dir <span class="op">/</span> <span class="st">&quot;ПапкаА&quot;</span> <span class="op">/</span> <span class="st">&quot;Подпапка&quot;</span> <span class="op">/</span> <span class="st">&quot;файл2.md&quot;</span>).write_text(<span class="st">&quot;# Файл в подпапке&quot;</span>)</span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Запускаем зеркалирование</span></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a>    mirror <span class="op">=</span> IdempotentMirror(test_mirror_dir, <span class="st">&quot;md&quot;</span>, <span class="st">&quot;fb2&quot;</span>)</span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a>    mirror.mirror_all()</span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Запускаем второй раз (должен пропустить)</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">🔄 ВТОРОЙ ЗАПУСК (должен быть идемпотентным):&quot;</span>, Colors.YELLOW)</span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>    mirror.mirror_all()</span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">════════════════════════════════════════&quot;</span>, Colors.BLUE)</span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>    print_color(<span class="st">&quot;✨ Демонстрация завершена&quot;</span>, Colors.GREEN)</span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> time</span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>    demo_idempotency()</span></code></pre></div>
<hr />
<h2 id="reference-doc-workflow-работа-с-шаблонами-pandoc">4️⃣
REFERENCE-DOC WORKFLOW (РАБОТА С ШАБЛОНАМИ PANDOC)</h2>
<h3 id="определение-3">📖 ОПРЕДЕЛЕНИЕ</h3>
<p><strong>Reference-doc workflow</strong> — метод конвертации, при
котором за основу дизайна берётся “файл-эталон” (.docx). Все стили
(шрифты, отступы, цвета) копируются из него в новый документ.</p>
<p><strong>Технически:</strong> Pandoc использует
<code>--reference-doc=template.docx</code> для извлечения стилей и
применения их к выходному документу. Шаблон должен быть правильно
настроен со всеми необходимыми стилями.</p>
<h3 id="графический-рисунок-3">🎨 ГРАФИЧЕСКИЙ РИСУНОК</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                    REFERENCE-DOC WORKFLOW                        │
└─────────────────────────────────────────────────────────────────┘

ШАБЛОН (reference.docx)                 РЕЗУЛЬТАТ (output.docx)
┌──────────────────────┐                ┌──────────────────────┐
│ Заголовок 1: Arial 16│                │ Заголовок 1: Arial 16│
│   ● стиль: Heading1  │    pandoc      │   ● тот же стиль     │
│                      │   ────────→    │                      │
│ Обычный текст:       │                │ Обычный текст:       │
│   Charter 12pt       │                │   Charter 12pt       │
│   ● стиль: Normal    │                │   ● стиль: Normal    │
│                      │                │                      │
│ Таблица: сетка,      │                │ Таблица: сетка,      │
│   шрифт Mono         │                │   шрифт Mono         │
└──────────────────────┘                └──────────────────────┘

ПРОЦЕСС:
┌─────────────────────────────────────────────────────────────┐
│ 1. Создаётся шаблон .docx с нужными стилями                │
│ 2. Pandoc читает стили из шаблона                          │
│ 3. Применяет их к конвертированному Markdown               │
│ 4. Результат сохраняет все настройки шаблона               │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 id="скрипт-для-termux-3">💻 СКРИПТ ДЛЯ TERMUX</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/data/data/com.termux/files/usr/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Файл: reference_doc_demo.sh</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Демонстрация Reference-doc workflow</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="va">GREEN</span><span class="op">=</span><span class="st">&#39;\033[0;32m&#39;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="va">BLUE</span><span class="op">=</span><span class="st">&#39;\033[0;34m&#39;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="va">YELLOW</span><span class="op">=</span><span class="st">&#39;\033[1;33m&#39;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="va">RED</span><span class="op">=</span><span class="st">&#39;\033[0;31m&#39;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="va">NC</span><span class="op">=</span><span class="st">&#39;\033[0m&#39;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">══════════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${GREEN}</span><span class="st">   ДЕМОНСТРАЦИЯ REFERENCE-DOC WORKFLOW</span><span class="va">${NC}</span><span class="st">&quot;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${BLUE}</span><span class="st">══════════════════════════════════════════════</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Конфигурация</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="va">TEMPLATE_DIR</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$HOME</span><span class="st">/.pandoc/templates&quot;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="va">TEMPLATE_FILE</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$TEMPLATE_DIR</span><span class="st">/elegant.docx&quot;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="va">DEMO_DIR</span><span class="op">=</span><span class="st">&quot;/storage/emulated/0/Documents/reference_doc_demo&quot;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="va">MARKDOWN_FILE</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">/sample.md&quot;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Создаём папки</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">&quot;</span><span class="va">$TEMPLATE_DIR</span><span class="st">&quot;</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">&quot;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ===== ШАГ 1: СОЗДАНИЕ REFERENCE-DOC =====</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">&quot;</span><span class="va">${YELLOW}</span><span class="st">ШАГ 1: Создание reference-doc шаблона</span><span class="va">${NC}</span><span class="st">\n&quot;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Создаём временный Markdown с описанием стилей</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;</span> <span class="st">&quot;</span><span class="va">$DEMO_DIR</span><span class="st">/style_definitions.md&quot;</span> <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="st">title: &quot;Определение стилей для шаблона&quot;</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="st">author: &quot;Рафаэль&quot;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="st">date: &quot;2026-02-23&quot;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="st"># Заголовок 1 (Heading 1)</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="st">Это обычный текст в стиле Normal. Здесь используется шрифт Charter.</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="st">## Заголовок 2 (Heading 2)</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="st">Продолжение текста для демонстрации стилей.</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="st">### Заголовок 3 (Heading 3)</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="st">Ещё текст для проверки иерархии.</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="st">**Жирный текст** и *курсив* для проверки.</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="st"># Таблица в Markdown</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="st">| Имя    | Возраст | Город      |</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="st">|--------|---------|------------|</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="st">| Анна   | 25      | Москва     |</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="st">| Иван   | 30      | Санкт-Петербург |</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="st"># Список</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="st">- Элемент 1</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="st">- Элемент 2</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="st">  - Подэлемент 2.1</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="st">  - Подэлемент 2.2</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="st"># Код</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="st">```bash</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="st">echo &quot;Пример кода&quot;</span></span></code></pre></div>
<p>EOF</p>
<p>echo -e “<span
class="math inline"><em>B</em><em>L</em><em>U</em><em>E</em>🔧<em>С</em><em>о</em><em>з</em><em>д</em><em>а</em><em>ю</em><em>б</em><em>а</em><em>з</em><em>о</em><em>в</em><em>ы</em><em>й</em><em>ш</em><em>а</em><em>б</em><em>л</em><em>о</em><em>н</em>...</span>{NC}”</p>
<h1 id="конвертируем-в-docx-это-будет-наш-reference-doc">Конвертируем в
docx (это будет наш reference-doc)</h1>
<p>pandoc “<span class="math inline">$DEMO_DIR/style_definitions.md" -o
"$</span>TEMPLATE_FILE”<br />
–from=markdown+pipe_tables+attributes<br />
–metadata=title:“Reference Template”</p>
<p>if [ <span class="math inline">$? -eq 0 ]; then
    echo -e "$</span>{GREEN}✅ Шаблон создан: <span
class="math inline"><em>T</em><em>E</em><em>M</em><em>P</em><em>L</em><em>A</em><em>T</em><em>E</em><sub><em>F</em></sub><em>I</em><em>L</em><em>E</em></span>{NC}”
else echo -e “<span
class="math inline"><em>R</em><em>E</em><em>D</em>❌<em>О</em><em>ш</em><em>и</em><em>б</em><em>к</em><em>а</em><em>с</em><em>о</em><em>з</em><em>д</em><em>а</em><em>н</em><em>и</em><em>я</em><em>ш</em><em>а</em><em>б</em><em>л</em><em>о</em><em>н</em><em>а</em></span>{NC}”
exit 1 fi</p>
<h1 id="шаг-2-инструкция-по-настройке-шаблона">===== ШАГ 2: ИНСТРУКЦИЯ
ПО НАСТРОЙКЕ ШАБЛОНА =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>2 : <em>Н</em><em>а</em><em>с</em><em>т</em><em>р</em><em>о</em><em>й</em><em>к</em><em>а</em><em>ш</em><em>а</em><em>б</em><em>л</em><em>о</em><em>н</em><em>а</em><em>в</em><em>W</em><em>o</em><em>r</em><em>d</em></span>{NC}”
echo -e “<span
class="math inline"><em>B</em><em>L</em><em>U</em><em>E</em>📝<em>И</em><em>н</em><em>с</em><em>т</em><em>р</em><em>у</em><em>к</em><em>ц</em><em>и</em><em>я</em>:</span>{NC}”
echo ” 1. Открой $TEMPLATE_FILE в Word или LibreOffice” echo ” 2.
Настрой стили:” echo ” - Heading 1: Montserrat, 16pt, полужирный” echo ”
- Heading 2: Montserrat, 14pt, полужирный” echo ” - Normal: Charter,
12pt” echo ” - Source Code: JetBrains Mono, 10pt” echo ” 3. Встрой
шрифты: Файл → Параметры → Сохранить → Встроить шрифты” echo ” 4.
Сохрани файл (он перезапишет шаблон)”</p>
<h1 id="шаг-3-демонстрационный-markdown">===== ШАГ 3: ДЕМОНСТРАЦИОННЫЙ
MARKDOWN =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>3 : <em>С</em><em>о</em><em>з</em><em>д</em><em>а</em><em>н</em><em>и</em><em>е</em><em>д</em><em>е</em><em>м</em><em>о</em><em>н</em><em>с</em><em>т</em><em>р</em><em>а</em><em>ц</em><em>и</em><em>о</em><em>н</em><em>н</em><em>о</em><em>г</em><em>о</em><em>M</em><em>a</em><em>r</em><em>k</em><em>d</em><em>o</em><em>w</em><em>n</em></span>{NC}”</p>
<h2 id="cat-markdown_file-eof">cat &gt; “$MARKDOWN_FILE” &lt;&lt;
‘EOF’</h2>
<p>title: “Моя прекрасная книга” author: “Рафаэль” date: “2026-02-23”
—</p>
<h1 id="введение">Введение</h1>
<p>Это первая глава моей книги. Здесь используется шрифт Charter для
основного текста, как настроено в шаблоне.</p>
<h2 id="подраздел-1.1">Подраздел 1.1</h2>
<p>Продолжение текста. <strong>Важный момент</strong> выделен
жирным.</p>
<h3 id="ещё-более-глубокий-уровень">Ещё более глубокий уровень</h3>
<p>Здесь мы проверяем, работают ли все уровни заголовков.</p>
<h1 id="таблица-данных">Таблица данных</h1>
<table>
<thead>
<tr>
<th>Продукт</th>
<th>Цена</th>
<th>Количество</th>
</tr>
</thead>
<tbody>
<tr>
<td>Яблоки</td>
<td>100</td>
<td>5</td>
</tr>
<tr>
<td>Груши</td>
<td>150</td>
<td>3</td>
</tr>
</tbody>
</table>
<h1 id="список-задач">Список задач</h1>
<ul class="task-list">
<li><label><input type="checkbox" checked="" />Создать
шаблон</label></li>
<li><label><input type="checkbox" />Настроить шрифты</label></li>
<li><label><input type="checkbox" />Протестировать
конвертацию</label></li>
</ul>
<h1 id="пример-кода">Пример кода</h1>
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hello():</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Привет, мир!&quot;</span>)</span></code></pre></div>
<p>EOF</p>
<p>echo -e “${GREEN}✅ Создан: <span
class="math inline"><em>M</em><em>A</em><em>R</em><em>K</em><em>D</em><em>O</em><em>W</em><em>N</em><sub><em>F</em></sub><em>I</em><em>L</em><em>E</em></span>{NC}”</p>
<h1 id="шаг-4-конвертация-с-reference-doc">===== ШАГ 4: КОНВЕРТАЦИЯ С
REFERENCE-DOC =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>4 : <em>К</em><em>о</em><em>н</em><em>в</em><em>е</em><em>р</em><em>т</em><em>а</em><em>ц</em><em>и</em><em>я</em><em>с</em><em>r</em><em>e</em><em>f</em><em>e</em><em>r</em><em>e</em><em>n</em><em>c</em><em>e</em> − <em>d</em><em>o</em><em>c</em></span>{NC}”</p>
<p>OUTPUT_FILE=“$DEMO_DIR/output.docx”</p>
<p>echo -e “<span
class="math inline"><em>B</em><em>L</em><em>U</em><em>E</em>🔄<em>К</em><em>о</em><em>н</em><em>в</em><em>е</em><em>р</em><em>т</em><em>и</em><em>р</em><em>у</em><em>ю</em><em>с</em><em>и</em><em>с</em><em>п</em><em>о</em><em>л</em><em>ь</em><em>з</em><em>о</em><em>в</em><em>а</em><em>н</em><em>и</em><em>е</em><em>м</em><em>ш</em><em>а</em><em>б</em><em>л</em><em>о</em><em>н</em><em>а</em>...</span>{NC}”
pandoc “<span class="math inline">$MARKDOWN_FILE" -o
"$</span>OUTPUT_FILE”<br />
–from=markdown+pipe_tables+attributes<br />
–reference-doc=“$TEMPLATE_FILE”<br />
–metadata=title:“Тестовая книга”<br />
–toc</p>
<p>if [ <span class="math inline">$? -eq 0 ]; then
    echo -e "$</span>{GREEN}✅ Готово: <span
class="math inline"><em>O</em><em>U</em><em>T</em><em>P</em><em>U</em><em>T</em><sub><em>F</em></sub><em>I</em><em>L</em><em>E</em></span>{NC}”
else echo -e “<span
class="math inline"><em>R</em><em>E</em><em>D</em>❌<em>О</em><em>ш</em><em>и</em><em>б</em><em>к</em><em>а</em><em>к</em><em>о</em><em>н</em><em>в</em><em>е</em><em>р</em><em>т</em><em>а</em><em>ц</em><em>и</em><em>и</em></span>{NC}”
fi</p>
<h1 id="шаг-5-функция-для-повседневного-использования">===== ШАГ 5:
ФУНКЦИЯ ДЛЯ ПОВСЕДНЕВНОГО ИСПОЛЬЗОВАНИЯ =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>5 : <em>С</em><em>о</em><em>з</em><em>д</em><em>а</em><em>н</em><em>и</em><em>е</em><em>ф</em><em>у</em><em>н</em><em>к</em><em>ц</em><em>и</em><em>и</em><em>д</em><em>л</em><em>я</em><em>п</em><em>о</em><em>в</em><em>с</em><em>е</em><em>д</em><em>н</em><em>е</em><em>в</em><em>н</em><em>о</em><em>г</em><em>о</em><em>и</em><em>с</em><em>п</em><em>о</em><em>л</em><em>ь</em><em>з</em><em>о</em><em>в</em><em>а</em><em>н</em><em>и</em><em>я</em></span>{NC}”</p>
<p>cat &gt; “$DEMO_DIR/convert_with_template.sh” &lt;&lt; ‘EOF’
#!/data/data/com.termux/files/usr/bin/bash # Функция для конвертации с
шаблоном</p>
<p>convert_with_style() { local input_file=“<span
class="math inline">$1"
    local output_file="$</span>{input_file%.md}.docx” local
template=“$HOME/.pandoc/templates/elegant.docx”</p>
<pre><code># Проверка входного файла
if [ ! -f &quot;$input_file&quot; ]; then
    echo &quot;❌ Файл не найден: $input_file&quot;
    return 1
fi

# Проверка шаблона
if [ ! -f &quot;$template&quot; ]; then
    echo &quot;⚠️ Шаблон не найден, конвертация без стилей&quot;
    template=&quot;&quot;
fi

# Сборка команды
CMD=&quot;pandoc \&quot;$input_file\&quot; -o \&quot;$output_file\&quot; \
    --from=markdown+pipe_tables+attributes \
    --toc&quot;

if [ -n &quot;$template&quot; ]; then
    CMD=&quot;$CMD --reference-doc=\&quot;$template\&quot;&quot;
fi

echo &quot;🔄 Конвертирую: $(basename &quot;$input_file&quot;)&quot;
eval $CMD

if [ $? -eq 0 ]; then
    echo &quot;✅ Готово: $(basename &quot;$output_file&quot;)&quot;
    
    # Информация о размере
    size=$(du -h &quot;$output_file&quot; | cut -f1)
    echo &quot;📊 Размер: $size&quot;
else
    echo &quot;❌ Ошибка&quot;
    return 1
fi</code></pre>
<p>}</p>
<h1 id="пример-использования">Пример использования</h1>
<p>if [ $# -eq 0 ]; then echo “Использование: $0 файл.md” exit 1 fi</p>
<p>convert_with_style “$1” EOF</p>
<p>chmod +x “<span
class="math inline">$DEMO_DIR/convert_with_template.sh"
echo -e "$</span>{GREEN}✅ Создан скрипт: <span
class="math inline"><em>D</em><em>E</em><em>M</em><em>O</em><sub><em>D</em></sub><em>I</em><em>R</em>/<em>c</em><em>o</em><em>n</em><em>v</em><em>e</em><em>r</em><em>t</em><sub><em>w</em></sub><em>i</em><em>t</em><em>h</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em><em>l</em><em>a</em><em>t</em><em>e</em>.<em>s</em><em>h</em></span>{NC}”</p>
<h1 id="шаг-6-интеграция-с-зеркальной-логикой">===== ШАГ 6: ИНТЕГРАЦИЯ С
ЗЕРКАЛЬНОЙ ЛОГИКОЙ =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>6 : <em>И</em><em>н</em><em>т</em><em>е</em><em>г</em><em>р</em><em>а</em><em>ц</em><em>и</em><em>я</em><em>с</em><em>з</em><em>е</em><em>р</em><em>к</em><em>а</em><em>л</em><em>ь</em><em>н</em><em>о</em><em>й</em><em>л</em><em>о</em><em>г</em><em>и</em><em>к</em><em>о</em><em>й</em></span>{NC}”</p>
<p>cat &gt; “$DEMO_DIR/mirror_with_template.sh” &lt;&lt; ‘EOF’
#!/data/data/com.termux/files/usr/bin/bash # Зеркальная конвертация с
использованием шаблона</p>
<p>WORK_DIR=“/storage/emulated/0/Documents/05_Элект_книги/02_md_docx_мддок”
TEMPLATE=“$HOME/.pandoc/templates/elegant.docx”</p>
<p>convert_file() { local md_file=“$1” local docx_file=“$2”</p>
<pre><code># Проверка необходимости конвертации
if [ -f &quot;$docx_file&quot; ] &amp;&amp; [ &quot;$md_file&quot; -ot &quot;$docx_file&quot; ]; then
    echo &quot;⏭️ Пропускаю (результат свежее): $(basename &quot;$md_file&quot;)&quot;
    return 0
fi

# Создаём папку
mkdir -p &quot;$(dirname &quot;$docx_file&quot;)&quot;

# Конвертация
echo &quot;🔄 Конвертирую: $(basename &quot;$md_file&quot;)&quot;
pandoc &quot;$md_file&quot; -o &quot;$docx_file&quot; \
    --from=markdown+pipe_tables+attributes \
    --reference-doc=&quot;$TEMPLATE&quot; \
    --toc

if [ $? -eq 0 ]; then
    echo &quot;✅ Готово: $(basename &quot;$docx_file&quot;)&quot;
else
    echo &quot;❌ Ошибка: $(basename &quot;$md_file&quot;)&quot;
fi</code></pre>
<p>}</p>
<h1 id="поиск-и-обработка">Поиск и обработка</h1>
<p>find “<span class="math inline">$WORK_DIR" -name "*.md" | while read
-r file; do
    filename=$</span>(basename”<span class="math inline">$file" .md)
    filedir=$</span>(dirname “$file”)</p>
<pre><code>if [ &quot;$filedir&quot; = &quot;$WORK_DIR&quot; ]; then
    # Корневой файл
    output=&quot;$WORK_DIR/$filename.docx&quot;
    convert_file &quot;$file&quot; &quot;$output&quot;
else
    # Файл в папке
    rel_path=&quot;${filedir#$WORK_DIR/}&quot;
    top_folder=&quot;${rel_path%%/*}&quot;
    sub_path=&quot;${rel_path#$top_folder}&quot;
    output=&quot;$WORK_DIR/${top_folder} - docx${sub_path}/$filename.docx&quot;
    convert_file &quot;$file&quot; &quot;$output&quot;
fi</code></pre>
<p>done EOF</p>
<p>chmod +x “<span
class="math inline">$DEMO_DIR/mirror_with_template.sh"
echo -e "$</span>{GREEN}✅ Создан скрипт: <span
class="math inline"><em>D</em><em>E</em><em>M</em><em>O</em><sub><em>D</em></sub><em>I</em><em>R</em>/<em>m</em><em>i</em><em>r</em><em>r</em><em>o</em><em>r</em><sub><em>w</em></sub><em>i</em><em>t</em><em>h</em><sub><em>t</em></sub><em>e</em><em>m</em><em>p</em><em>l</em><em>a</em><em>t</em><em>e</em>.<em>s</em><em>h</em></span>{NC}”</p>
<h1 id="шаг-7-проверка-шрифтов">===== ШАГ 7: ПРОВЕРКА ШРИФТОВ =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>7 : <em>П</em><em>р</em><em>о</em><em>в</em><em>е</em><em>р</em><em>к</em><em>а</em><em>в</em><em>с</em><em>т</em><em>р</em><em>о</em><em>е</em><em>н</em><em>н</em><em>ы</em><em>х</em><em>ш</em><em>р</em><em>и</em><em>ф</em><em>т</em><em>о</em><em>в</em></span>{NC}”</p>
<p>cat &gt; “$DEMO_DIR/check_fonts.sh” &lt;&lt; ‘EOF’
#!/data/data/com.termux/files/usr/bin/bash # Проверка встроенных шрифтов
в docx</p>
<p>check_fonts() { local docx_file=“$1”</p>
<pre><code>if [ ! -f &quot;$docx_file&quot; ]; then
    echo &quot;❌ Файл не найден&quot;
    return 1
fi

echo &quot;🔍 Анализ: $(basename &quot;$docx_file&quot;)&quot;

# Создаём временную папку для анализа
TMP_DIR=&quot;/data/data/com.termux/files/home/tmp/font_check&quot;
mkdir -p &quot;$TMP_DIR&quot;

# Распаковываем docx (это zip-архив)
unzip -q &quot;$docx_file&quot; -d &quot;$TMP_DIR&quot; 2&gt;/dev/null

# Ищем информацию о шрифтах
echo -e &quot;\n📊 Информация о шрифтах:&quot;

# Проверяем document.xml на наличие шрифтов
if [ -f &quot;$TMP_DIR/word/document.xml&quot; ]; then
    echo &quot;   Шрифты в документе:&quot;
    grep -o &#39;w:ascii=&quot;[^&quot;]*&quot;&#39; &quot;$TMP_DIR/word/document.xml&quot; | sort -u | sed &#39;s/w:ascii=/   • /g&#39;
    grep -o &#39;w:hAnsi=&quot;[^&quot;]*&quot;&#39; &quot;$TMP_DIR/word/document.xml&quot; | sort -u | sed &#39;s/w:hAnsi=/   • /g&#39;
fi

# Проверяем, есть ли встроенные шрифты
if [ -d &quot;$TMP_DIR/word/fonts&quot; ]; then
    echo -e &quot;\n✅ Встроенные шрифты найдены:&quot;
    ls -1 &quot;$TMP_DIR/word/fonts&quot; | sed &#39;s/^/   • /&#39;
else
    echo -e &quot;\n❌ Встроенные шрифты не найдены&quot;
fi

# Очистка
rm -rf &quot;$TMP_DIR&quot;</code></pre>
<p>}</p>
<h1 id="использование">Использование</h1>
<p>if [ $# -eq 0 ]; then echo “Использование: $0 файл.docx” exit 1
fi</p>
<p>check_fonts “$1” EOF</p>
<p>chmod +x “<span class="math inline">$DEMO_DIR/check_fonts.sh"
echo -e "$</span>{GREEN}✅ Создан скрипт проверки шрифтов${NC}”</p>
<h1 id="шаг-8-создание-шаблона-python">===== ШАГ 8: СОЗДАНИЕ ШАБЛОНА
PYTHON =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>Ш</em><em>А</em><em>Г</em>8 : <em>P</em><em>y</em><em>t</em><em>h</em><em>o</em><em>n</em> − <em>с</em><em>к</em><em>р</em><em>и</em><em>п</em><em>т</em><em>д</em><em>л</em><em>я</em><em>о</em><em>б</em><em>н</em><em>о</em><em>в</em><em>л</em><em>е</em><em>н</em><em>и</em><em>я</em><em>ш</em><em>а</em><em>б</em><em>л</em><em>о</em><em>н</em><em>а</em></span>{NC}”</p>
<p>cat &gt; “$DEMO_DIR/update_template.py” &lt;&lt; ‘EOF’ #!/usr/bin/env
python3 # Файл: update_template.py # Скрипт для обновления reference-doc
шаблона</p>
<p>import os import zipfile import tempfile import shutil from pathlib
import Path import xml.etree.ElementTree as ET</p>
<p>class TemplateUpdater: “““Класс для обновления reference-doc
шаблона”“”</p>
<pre><code>def __init__(self, template_path):
    self.template_path = Path(template_path)
    self.temp_dir = Path(tempfile.mkdtemp())
    
def extract_template(self):
    &quot;&quot;&quot;Распаковка docx шаблона&quot;&quot;&quot;
    print(f&quot;📦 Распаковка: {self.template_path.name}&quot;)
    with zipfile.ZipFile(self.template_path, &#39;r&#39;) as zip_ref:
        zip_ref.extractall(self.temp_dir)

def update_styles(self):
    &quot;&quot;&quot;Обновление стилей в document.xml&quot;&quot;&quot;
    document_xml = self.temp_dir / &#39;word&#39; / &#39;document.xml&#39;
    styles_xml = self.temp_dir / &#39;word&#39; / &#39;styles.xml&#39;
    
    if not document_xml.exists():
        print(&quot;❌ document.xml не найден&quot;)
        return
    
    # Регистрируем пространства имён
    namespaces = {
        &#39;w&#39;: &#39;http://schemas.openxmlformats.org/wordprocessingml/2006/main&#39;
    }
    
    # Обновляем стили в document.xml
    tree = ET.parse(document_xml)
    root = tree.getroot()
    
    # Здесь можно добавить автоматическое обновление стилей
    # Например, установка шрифтов по умолчанию
    
    tree.write(document_xml, encoding=&#39;UTF-8&#39;, xml_declaration=True)
    print(&quot;✅ Стили обновлены&quot;)

def embed_fonts(self, font_dir):
    &quot;&quot;&quot;Встраивание шрифтов в шаблон&quot;&quot;&quot;
    font_target = self.temp_dir / &#39;word&#39; / &#39;fonts&#39;
    font_target.mkdir(exist_ok=True)
    
    if not font_dir.exists():
        print(f&quot;❌ Папка со шрифтами не найдена: {font_dir}&quot;)
        return
    
    fonts_copied = 0
    for font_file in font_dir.glob(&quot;*.ttf&quot;):
        shutil.copy2(font_file, font_target / font_file.name)
        fonts_copied += 1
        print(f&quot;   ✅ Встроен: {font_file.name}&quot;)
    
    # Обновляем _rels/.rels для подключения шрифтов
    rels_file = self.temp_dir / &#39;word&#39; / &#39;_rels&#39; / &#39;document.xml.rels&#39;
    if rels_file.exists():
        tree = ET.parse(rels_file)
        root = tree.getroot()
        
        # Добавляем отношения для шрифтов
        ns = {&#39;rel&#39;: &#39;http://schemas.openxmlformats.org/package/2006/relationships&#39;}
        
        for i, font_file in enumerate(font_target.glob(&quot;*.ttf&quot;)):
            rel_elem = ET.Element(f&quot;{{{ns[&#39;rel&#39;]}}}Relationship&quot;)
            rel_elem.set(&quot;Id&quot;, f&quot;fontId{i}&quot;)
            rel_elem.set(&quot;Type&quot;, &quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/font&quot;)
            rel_elem.set(&quot;Target&quot;, f&quot;fonts/{font_file.name}&quot;)
            root.append(rel_elem)
        
        tree.write(rels_file, encoding=&#39;UTF-8&#39;, xml_declaration=True)
    
    print(f&quot;\n✅ Встроено шрифтов: {fonts_copied}&quot;)

def pack_template(self, output_path):
    &quot;&quot;&quot;Упаковка обратно в docx&quot;&quot;&quot;
    with zipfile.ZipFile(output_path, &#39;w&#39;, zipfile.ZIP_DEFLATED) as zip_ref:
        for file_path in self.temp_dir.rglob(&quot;*&quot;):
            if file_path.is_file():
                arcname = str(file_path.relative_to(self.temp_dir))
                zip_ref.write(file_path, arcname)
    
    print(f&quot;✅ Шаблон сохранён: {output_path}&quot;)

def cleanup(self):
    &quot;&quot;&quot;Очистка временных файлов&quot;&quot;&quot;
    shutil.rmtree(self.temp_dir)
    print(&quot;🧹 Временные файлы удалены&quot;)</code></pre>
<p>def main(): print(“=”<em>50) print(” ОБНОВЛЕНИЕ REFERENCE-DOC
ШАБЛОНА”) print(“=”</em>50)</p>
<pre><code># Конфигурация
template_path = Path(os.path.expanduser(&quot;~/.pandoc/templates/elegant.docx&quot;))
font_dir = Path(&quot;/storage/emulated/0/Documents/15_Настройки_скрипты_Termux_бекап_рестор/Шрифты&quot;)
backup_path = template_path.with_suffix(&quot;.backup.docx&quot;)

# Создаём папки
template_path.parent.mkdir(parents=True, exist_ok=True)

# Проверка существования шаблона
if not template_path.exists():
    print(f&quot;⚠️ Шаблон не найден, будет создан новый&quot;)
    # Создаём пустой docx через pandoc
    os.system(f&#39;echo &quot; &quot; | pandoc -o &quot;{template_path}&quot;&#39;)

# Создаём бэкап
if template_path.exists():
    shutil.copy2(template_path, backup_path)
    print(f&quot;📦 Бэкап создан: {backup_path.name}&quot;)

# Обновление шаблона
updater = TemplateUpdater(template_path)

try:
    # Распаковка
    updater.extract_template()
    
    # Обновление стилей
    updater.update_styles()
    
    # Встраивание шрифтов
    if font_dir.exists():
        updater.embed_fonts(font_dir)
    else:
        print(f&quot;⚠️ Папка со шрифтами не найдена: {font_dir}&quot;)
    
    # Упаковка обратно
    updater.pack_template(template_path)
    
    print(&quot;\n✨ Шаблон успешно обновлён!&quot;)
    
finally:
    # Очистка
    updater.cleanup()</code></pre>
<p>if <strong>name</strong> == “<strong>main</strong>”: main() EOF</p>
<p>chmod +x “<span class="math inline">$DEMO_DIR/update_template.py"
echo -e "$</span>{GREEN}✅ Создан Python-скрипт для обновления
шаблона${NC}”</p>
<p>echo -e “<span
class="math inline"><em>B</em><em>L</em><em>U</em><em>E</em>══════════════════════════════════════════════</span>{NC}”
echo -e “<span
class="math inline"><em>G</em><em>R</em><em>E</em><em>E</em><em>N</em>✨<em>Д</em><em>е</em><em>м</em><em>о</em><em>н</em><em>с</em><em>т</em><em>р</em><em>а</em><em>ц</em><em>и</em><em>я</em><em>R</em><em>e</em><em>f</em><em>e</em><em>r</em><em>e</em><em>n</em><em>c</em><em>e</em> − <em>d</em><em>o</em><em>c</em><em>w</em><em>o</em><em>r</em><em>k</em><em>f</em><em>l</em><em>o</em><em>w</em><em>з</em><em>а</em><em>в</em><em>е</em><em>р</em><em>ш</em><em>е</em><em>н</em><em>а</em></span>{NC}”
echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em>📁<em>В</em><em>с</em><em>е</em><em>ф</em><em>а</em><em>й</em><em>л</em><em>ы</em><em>в</em>:</span>{NC}
$DEMO_DIR”</p>
<pre><code>
---

## 5️⃣ PANDOC EXTENSIONS (РАСШИРЕНИЯ PANDOC)

### 📖 ОПРЕДЕЛЕНИЕ
**Pandoc Extensions** — это набор дополнительных возможностей Markdown, которые можно включить для расширения синтаксиса. Они позволяют использовать таблицы, сноски, атрибуты, математические формулы и многое другое.

**Технически:** Указываются через `--from=markdown+extension1+extension2` или `-f markdown+pipe_tables+attributes`.

### 🎨 ГРАФИЧЕСКИЙ РИСУНОК</code></pre>
<p>БАЗОВЫЙ MARKDOWN РАСШИРЕННЫЙ MARKDOWN
───────────────────────────────────────────────────────────────── #
Заголовок # Заголовок {#id .class} <a href="#атрибуты">атрибуты</a></p>
<ul>
<li><p>список * список [с атрибутами]</p>
<pre><code>                             | Таблица | с |
                             |---------|---|
                             | pipe_tables  |</code></pre></li>
</ul>
<p><a href="url">ссылка</a> <a href="url" target="_blank">ссылка</a></p>
<pre><code>                               ^[Сноска с пояснением]

                               $x^2 + y^2 = z^2$
                               [TeX математика]</code></pre>
<p>ОСНОВНЫЕ РАСШИРЕНИЯ:
┌─────────────────────────────────────────────────────────────────┐ │
pipe_tables │ таблицы через | │ │ attributes │ {#id .class key=value} │
│ footnotes │ сноски через <a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a> │ │ citations │
цитирование <span class="citation"
data-cites="citekey">[@citekey]</span> │ │ tex_math_dollars│ математика
<span class="math inline">...</span> или <span
class="math display">...</span> │ │ task_lists │ списки задач - [x] и -
[ ] │ │ raw_html │ вставка HTML-кода │ │ yaml_metadata_block│ YAML
заголовок — … — │
└─────────────────────────────────────────────────────────────────┘</p>
<pre><code>
### 💻 СКРИПТ ДЛЯ TERMUX

```bash
#!/data/data/com.termux/files/usr/bin/bash
# Файл: pandoc_extensions_demo.sh
# Демонстрация всех расширений Pandoc

GREEN=&#39;\033[0;32m&#39;
BLUE=&#39;\033[0;34m&#39;
YELLOW=&#39;\033[1;33m&#39;
RED=&#39;\033[0;31m&#39;
NC=&#39;\033[0m&#39;

echo -e &quot;${BLUE}══════════════════════════════════════════════${NC}&quot;
echo -e &quot;${GREEN}   ДЕМОНСТРАЦИЯ PANDOC EXTENSIONS${NC}&quot;
echo -e &quot;${BLUE}══════════════════════════════════════════════${NC}\n&quot;

DEMO_DIR=&quot;/storage/emulated/0/Documents/pandoc_extensions_demo&quot;
mkdir -p &quot;$DEMO_DIR&quot;

# ===== СОЗДАНИЕ ДЕМОНСТРАЦИОННОГО ФАЙЛА =====
echo -e &quot;${YELLOW}Создание демонстрационного Markdown со всеми расширениями${NC}\n&quot;

cat &gt; &quot;$DEMO_DIR/all_extensions.md&quot; &lt;&lt; &#39;EOF&#39;
---
title: &quot;Демонстрация всех расширений Pandoc&quot;
author: &quot;Рафаэль&quot;
date: &quot;2026-02-23&quot;
keywords: [pandoc, markdown, extensions]
abstract: |
  Этот файл демонстрирует все основные расширения Pandoc.
  Каждый раздел показывает конкретное расширение.
---

# 1. Pipe Tables {#pipe-tables .section}
Расширение для создания таблиц через вертикальные черты.

| Расширение | Описание | Статус |
|:-----------|:--------:|-------:|
| pipe_tables| Таблицы  | ✅     |
| attributes | Атрибуты | ✅     |
| footnotes  | Сноски   | ✅     |

Таблица 1: Пример pipe_tables с выравниванием

# 2. Attributes {#attributes .section key=value}
Атрибуты для заголовков, ссылок и блоков.

## Заголовок с атрибутами {#custom-id .class-name data-custom=&quot;value&quot;}

Обычный текст с [ссылкой](https://example.com){target=&quot;_blank&quot; rel=&quot;noopener&quot;}.

![Картинка с атрибутами](image.jpg){width=50% height=auto}

# 3. Footnotes (Сноски) {#footnotes}
Здесь показаны сноски^[Это обычная сноска с пояснением] и ссылки на сноски[^longnote].

[^longnote]: Это многострочная сноска.
    Она может содержать несколько абзацев.
    
    И даже списки:
    - Элемент 1
    - Элемент 2

# 4. Citations (Цитирование) {#citations}
Как сказано в [@smith2000, p. 42], это важно. 
Сравни с [@jones1999; @brown2001].

# Библиография
::: {#refs}
:::

# 5. TeX Math (Математика) {#math}
Внутристрочная формула: $E = mc^2$.

Выключная формула:
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

# 6. Task Lists (Списки задач) {#task-lists}
- [x] Сделать документацию
- [x] Написать примеры
- [ ] Проверить конвертацию
- [ ] Опубликовать результат

# 7. Definition Lists (Списки определений) {#definition-lists}

Термин 1
:   Определение 1
:   Второе определение

Термин 2
:   Определение с несколькими
    строками текста

# 8. Fenced Divs (Блоки с атрибутами) {#fenced-divs}

::: {.warning style=&quot;color: red;&quot;}
Это блок с предупреждением.
Он будет стилизован особым образом.
:::

::: {.note .important}
Важное примечание с несколькими
абзацами текста.

Второй абзац в том же блоке.
:::

# 9. Raw HTML/TeX {#raw-html}
&lt;div style=&quot;border:1px solid black; padding:10px;&quot;&gt;
Это &lt;span style=&quot;color:blue;&quot;&gt;HTML&lt;/span&gt; внутри Markdown.
&lt;/div&gt;

\newcommand{\RR}{\mathbb{R}}
В LaTeX можно определять команды: $\RR$

# 10. Line Blocks (Блоки строк) {#line-blocks}
| Эта строка
|   сохранит
|     все пробелы
| и переносы

# 11. Grid Tables (Сложные таблицы) {#grid-tables}
+-----------+-----------+
| Заголовок | Заголовок |
+===========+===========+
| Ячейка    | Ячейка    |
+-----------+-----------+
| Объединённая ячейка     |
+-----------+-----------+

# 12. Markdown в HTML {#markdown-in-html}
&lt;div markdown=&quot;1&quot;&gt;
Это **Markdown** внутри HTML-блока.
- Список
- Пункты
&lt;/div&gt;

# 13. YAML Metadata (Метаданные) {#yaml}
Уже в начале файла показан YAML-блок с:
- title
- author
- date
- keywords
- abstract

# 14. Smart Punctuation (Умная типографика) {#smart}
Обычные кавычки &quot;становятся&quot; типографскими &quot;ёлочками&quot;.
Три точки... становятся многоточием…
-- и --- становятся тире.
EOF

echo -e &quot;${GREEN}✅ Создан демо-файл: $DEMO_DIR/all_extensions.md${NC}&quot;

# ===== ФУНКЦИЯ ДЛЯ ТЕСТИРОВАНИЯ РАСШИРЕНИЙ =====
test_extension() {
    local name=&quot;$1&quot;
    local ext=&quot;$2&quot;
    local output=&quot;$DEMO_DIR/test_${name}.md&quot;
    
    echo -e &quot;\n${BLUE}🧪 Тестирование: ${YELLOW}$name${NC} ($ext)&quot;
    
    # Создаём тестовый файл для конкретного расширения
    case $name in
        &quot;pipe_tables&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
| Header1 | Header2 |
|---------|---------|
| cell1   | cell2   |
EOF
            ;;
        &quot;attributes&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
# Title {#id .class}
[link](url){target=&quot;_blank&quot;}
EOF
            ;;
        &quot;footnotes&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
Text^[footnote] and [^long].

[^long]: Long note.
EOF
            ;;
        &quot;citations&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
See [@doe99] and [@smith2000, p. 33].
EOF
            ;;
        &quot;tex_math_dollars&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
Inline $x^2$ and display $$y = mx + b$$.
EOF
            ;;
        &quot;task_lists&quot;)
            cat &gt; &quot;$output&quot; &lt;&lt; &#39;EOF&#39;
- [x] done
- [ ] todo
EOF
            ;;
    esac
    
    # Конвертируем с расширением и без
    echo -n &quot;   Без расширения: &quot;
    pandoc &quot;$output&quot; -t plain 2&gt;/dev/null | head -1
    
    echo -n &quot;   С расширением:  &quot;
    pandoc &quot;$output&quot; -t plain --from=markdown+&quot;$ext&quot; 2&gt;/dev/null | head -1
}

# ===== ТЕСТИРОВАНИЕ КАЖДОГО РАСШИРЕНИЯ =====
echo -e &quot;\n${YELLOW}Тестирование отдельных расширений:${NC}&quot;

test_extension &quot;pipe_tables&quot; &quot;pipe_tables&quot;
test_extension &quot;attributes&quot; &quot;attributes&quot;
test_extension &quot;footnotes&quot; &quot;footnotes&quot;
test_extension &quot;tex_math_dollars&quot; &quot;tex_math_dollars&quot;
test_extension &quot;task_lists&quot; &quot;task_lists&quot;

# ===== КОНВЕРТАЦИЯ В РАЗНЫЕ ФОРМАТЫ =====
echo -e &quot;\n${YELLOW}Конвертация в разные форматы:${NC}&quot;

# HTML
echo -e &quot;\n${BLUE}📄 HTML:${NC}&quot;
pandoc &quot;$DEMO_DIR/all_extensions.md&quot; -o &quot;$DEMO_DIR/output.html&quot; \
    --from=markdown+pipe_tables+attributes+footnotes+citations+tex_math_dollars+task_lists+raw_html \
    --standalone --toc
echo -e &quot;${GREEN}✅ $DEMO_DIR/output.html${NC}&quot;

# DOCX
echo -e &quot;\n${BLUE}📄 DOCX:${NC}&quot;
pandoc &quot;$DEMO_DIR/all_extensions.md&quot; -o &quot;$DEMO_DIR/output.docx&quot; \
    --from=markdown+pipe_tables+attributes+footnotes+citations+tex_math_dollars+task_lists \
    --toc
echo -e &quot;${GREEN}✅ $DEMO_DIR/output.docx${NC}&quot;

# PDF (если есть движок)
if command -v pdflatex &amp;&gt;/dev/null; then
    echo -e &quot;\n${BLUE}📄 PDF:${NC}&quot;
    pandoc &quot;$DEMO_DIR/all_extensions.md&quot; -o &quot;$DEMO_DIR/output.pdf&quot; \
        --from=markdown+pipe_tables+attributes+footnotes+citations+tex_math_dollars \
        --pdf-engine=pdflatex
    echo -e &quot;${GREEN}✅ $DEMO_DIR/output.pdf${NC}&quot;
fi

# ===== СОЗДАНИЕ ФУНКЦИИ-ПОМОЩНИКА =====
echo -e &quot;\n${YELLOW}Создание функции-помощника:${NC}&quot;

cat &gt; &quot;$DEMO_DIR/pandoc_helper.sh&quot; &lt;&lt; &#39;EOF&#39;
#!/data/data/com.termux/files/usr/bin/bash
# Универсальная функция конвертации со всеми расширениями

pandoc_all() {
    local input=&quot;$1&quot;
    local output=&quot;${2:-${input%.*}.docx}&quot;
    
    # Базовые расширения
    EXTENSIONS=&quot;pipe_tables+attributes+footnotes+citations+tex_math_dollars+task_lists+definition_lists+fenced_divs+raw_html+grid_tables+line_blocks+yaml_metadata_block+smart&quot;
    
    # Дополнительные расширения в зависимости от формата
    case &quot;${output##*.}&quot; in
        html)
            EXTENSIONS=&quot;${EXTENSIONS}+raw_html+markdown_in_html_blocks&quot;
            ;;
        pdf)
            EXTENSIONS=&quot;${EXTENSIONS}+tex_math_dollars&quot;
            ;;
    esac
    
    echo &quot;🔄 Конвертация: $(basename &quot;$input&quot;) → $(basename &quot;$output&quot;)&quot;
    echo &quot;📦 Расширения: ${EXTENSIONS}&quot;
    
    pandoc &quot;$input&quot; -o &quot;$output&quot; \
        --from=markdown+&quot;${EXTENSIONS}&quot; \
        --to=&quot;${output##*.}&quot; \
        --standalone \
        --toc \
        --highlight-style=tango \
        --wrap=preserve
    
    if [ $? -eq 0 ]; then
        echo &quot;✅ Готово!&quot;
        echo &quot;📊 Размер: $(du -h &quot;$output&quot; | cut -f1)&quot;
    else
        echo &quot;❌ Ошибка!&quot;
        return 1
    fi
}

# Список доступных расширений
pandoc_list() {
    pandoc --list-extensions=markdown | sort | column
}

# Проверка конкретного расширения
pandoc_check() {
    local ext=&quot;$1&quot;
    if pandoc --list-extensions=markdown | grep -q &quot;^$ext$&quot;; then
        echo &quot;✅ Расширение &#39;$ext&#39; доступно&quot;
    else
        echo &quot;❌ Расширение &#39;$ext&#39; НЕ доступно&quot;
    fi
}

# Меню помощи
case &quot;${1:-}&quot; in
    list)
        pandoc_list
        ;;
    check)
        pandoc_check &quot;$2&quot;
        ;;
    *)
        if [ $# -gt 0 ]; then
            pandoc_all &quot;$@&quot;
        else
            echo &quot;Использование:&quot;
            echo &quot;  $0 файл.md [выходной.формат]&quot;
            echo &quot;  $0 list              - список расширений&quot;
            echo &quot;  $0 check РАСШИРЕНИЕ  - проверить расширение&quot;
        fi
        ;;
esac
EOF

chmod +x &quot;$DEMO_DIR/pandoc_helper.sh&quot;
echo -e &quot;${GREEN}✅ Создан: $DEMO_DIR/pandoc_helper.sh${NC}&quot;

# ===== СОЗДАНИЕ ШПАРГАЛКИ =====
echo -e &quot;\n${YELLOW}Создание шпаргалки по расширениям:${NC}&quot;

cat &gt; &quot;$DEMO_DIR/extensions_cheatsheet.md&quot; &lt;&lt; &#39;EOF&#39;
# 📚 ШПАРГАЛКА ПО РАСШИРЕНИЯМ PANDOC

## 🎯 БАЗОВЫЙ НАБОР (для повседневной работы)
```bash
pandoc input.md -o output.docx \
    --from=markdown+pipe_tables+attributes+footnotes+yaml_metadata_block</code></pre>
<h2 id="полный-набор-все-расширения">📋 ПОЛНЫЙ НАБОР (все
расширения)</h2>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> input.md <span class="at">-o</span> output.docx <span class="dt">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--from</span><span class="op">=</span>markdown+pipe_tables+attributes+footnotes+citations+tex_math_dollars+task_lists+definition_lists+fenced_divs+raw_html+grid_tables+line_blocks+yaml_metadata_block+smart</span></code></pre></div>
<h2 id="расширения-по-категориям">🔧 РАСШИРЕНИЯ ПО КАТЕГОРИЯМ</h2>
<h3 id="таблицы">Таблицы</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pipe_tables</code></td>
<td>Простые таблицы через <code>|</code></td>
<td><code>| a | b |</code></td>
</tr>
<tr>
<td><code>grid_tables</code></td>
<td>Сложные таблицы с рамками</td>
<td><code>+---+---+</code></td>
</tr>
<tr>
<td><code>multiline_tables</code></td>
<td>Многострочные таблицы</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="атрибуты">Атрибуты</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>attributes</code></td>
<td>ID, классы, ключи</td>
<td><code>{#id .class key=val}</code></td>
</tr>
<tr>
<td><code>link_attributes</code></td>
<td>Атрибуты ссылок</td>
<td><code>[text](url){target="_blank"}</code></td>
</tr>
<tr>
<td><code>mmd_header_attributes</code></td>
<td>Атрибуты заголовков</td>
<td><code>## Header {#id}</code></td>
</tr>
</tbody>
</table>
<h3 id="текст-и-разметка">Текст и разметка</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>footnotes</code></td>
<td>Сноски</td>
<td><code>^[text]</code> или <code>[^id]</code></td>
</tr>
<tr>
<td><code>citations</code></td>
<td>Цитирование</td>
<td><code>[@citekey]</code></td>
</tr>
<tr>
<td><code>tex_math_dollars</code></td>
<td>Математика</td>
<td><code>$x^2$</code> или <code>$$x^2$$</code></td>
</tr>
<tr>
<td><code>raw_html</code></td>
<td>HTML-код</td>
<td><code>&lt;div&gt;...&lt;/div&gt;</code></td>
</tr>
<tr>
<td><code>raw_tex</code></td>
<td>LaTeX-код</td>
<td><code>\LaTeX{}</code></td>
</tr>
<tr>
<td><code>markdown_in_html_blocks</code></td>
<td>Markdown в HTML</td>
<td><code>&lt;div markdown=1&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="списки">Списки</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>task_lists</code></td>
<td>Списки задач</td>
<td><code>- [x] done</code></td>
</tr>
<tr>
<td><code>definition_lists</code></td>
<td>Списки определений</td>
<td><code>Term\n: definition</code></td>
</tr>
<tr>
<td><code>compact_definition_lists</code></td>
<td>Компактные списки</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="блоки-и-структура">Блоки и структура</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fenced_divs</code></td>
<td>Блоки с атрибутами</td>
<td><code>::: {.class}</code></td>
</tr>
<tr>
<td><code>fenced_code_blocks</code></td>
<td>Блоки кода</td>
<td><code>python</code></td>
</tr>
<tr>
<td><code>line_blocks</code></td>
<td>Блоки строк</td>
<td><code>| line</code></td>
</tr>
<tr>
<td><code>hard_line_breaks</code></td>
<td>Жёсткие переносы</td>
<td></td>
</tr>
<tr>
<td><code>escaped_line_breaks</code></td>
<td>Экранированные переносы</td>
<td><code>\</code></td>
</tr>
</tbody>
</table>
<h3 id="метаданные">Метаданные</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>yaml_metadata_block</code></td>
<td>YAML заголовок</td>
<td><code>---\ntitle:...\n---</code></td>
</tr>
<tr>
<td><code>pandoc_title_block</code></td>
<td>Заголовок Pandoc</td>
<td><code>% title</code></td>
</tr>
<tr>
<td><code>biblatex</code></td>
<td>Библиография BibLaTeX</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="типографика">Типографика</h3>
<table>
<thead>
<tr>
<th>Расширение</th>
<th>Описание</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>smart</code></td>
<td>Умная типографика</td>
<td><code>"кавычки"</code> → «кавычки»</td>
</tr>
<tr>
<td><code>emoji</code></td>
<td>Эмодзи</td>
<td><code>:smile:</code> → 😊</td>
</tr>
<tr>
<td><code>autolink_bare_uris</code></td>
<td>Автоссылки</td>
<td><code>https://example.com</code></td>
</tr>
</tbody>
</table>
<h2 id="примеры-использования">🚀 ПРИМЕРЫ ИСПОЛЬЗОВАНИЯ</h2>
<h3 id="для-книги-docx">Для книги (DOCX)</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> book.md <span class="at">-o</span> book.docx <span class="dt">\</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--from</span><span class="op">=</span>markdown+pipe_tables+attributes+footnotes+task_lists+yaml_metadata_block+smart <span class="dt">\</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--reference-doc</span><span class="op">=</span>template.docx <span class="dt">\</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">--toc</span></span></code></pre></div>
<h3 id="для-веба-html">Для веба (HTML)</h3>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> article.md <span class="at">-o</span> article.html <span class="dt">\</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--from</span><span class="op">=</span>markdown+pipe_tables+attributes+footnotes+raw_html+markdown_in_html_blocks <span class="dt">\</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--standalone</span> <span class="dt">\</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">--mathjax</span></span></code></pre></div>
<h3 id="для-научной-статьи-pdf">Для научной статьи (PDF)</h3>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> paper.md <span class="at">-o</span> paper.pdf <span class="dt">\</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--from</span><span class="op">=</span>markdown+pipe_tables+attributes+footnotes+citations+tex_math_dollars <span class="dt">\</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">--citeproc</span> <span class="dt">\</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">--bibliography</span><span class="op">=</span>refs.bib</span></code></pre></div>
<h2 id="проверка-доступных-расширений">🔍 ПРОВЕРКА ДОСТУПНЫХ
РАСШИРЕНИЙ</h2>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Все доступные расширения</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">--list-extensions</span><span class="op">=</span>markdown <span class="kw">|</span> <span class="fu">sort</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Проверка конкретного</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">--list-extensions</span><span class="op">=</span>markdown <span class="kw">|</span> <span class="fu">grep</span> pipe_tables</span></code></pre></div>
<h2 id="быстрый-тест-расширения">⚡ БЫСТРЫЙ ТЕСТ РАСШИРЕНИЯ</h2>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;| a | b |&quot;</span> <span class="kw">|</span> <span class="ex">pandoc</span> <span class="at">-f</span> markdown+pipe_tables <span class="at">-t</span> plain</span></code></pre></div>
<p>EOF</p>
<p>echo -e “${GREEN}✅ Создана шпаргалка: <span
class="math inline"><em>D</em><em>E</em><em>M</em><em>O</em><sub><em>D</em></sub><em>I</em><em>R</em>/<em>e</em><em>x</em><em>t</em><em>e</em><em>n</em><em>s</em><em>i</em><em>o</em><em>n</em><em>s</em><sub><em>c</em></sub><em>h</em><em>e</em><em>a</em><em>t</em><em>s</em><em>h</em><em>e</em><em>e</em><em>t</em>.<em>m</em><em>d</em></span>{NC}”</p>
<h1 id="тестовый-запуск">===== ТЕСТОВЫЙ ЗАПУСК =====</h1>
<p>echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em><em>З</em><em>а</em><em>п</em><em>у</em><em>с</em><em>к</em><em>т</em><em>е</em><em>с</em><em>т</em><em>о</em><em>в</em><em>о</em><em>й</em><em>к</em><em>о</em><em>н</em><em>в</em><em>е</em><em>р</em><em>т</em><em>а</em><em>ц</em><em>и</em><em>и</em>:</span>{NC}”
“<span class="math inline">$DEMO_DIR/pandoc_helper.sh"
"$</span>DEMO_DIR/all_extensions.md” “$DEMO_DIR/test_output.docx”</p>
<p>echo -e “<span
class="math inline"><em>B</em><em>L</em><em>U</em><em>E</em>══════════════════════════════════════════════</span>{NC}”
echo -e “<span
class="math inline"><em>G</em><em>R</em><em>E</em><em>E</em><em>N</em>✨<em>Д</em><em>е</em><em>м</em><em>о</em><em>н</em><em>с</em><em>т</em><em>р</em><em>а</em><em>ц</em><em>и</em><em>я</em><em>P</em><em>a</em><em>n</em><em>d</em><em>o</em><em>c</em><em>E</em><em>x</em><em>t</em><em>e</em><em>n</em><em>s</em><em>i</em><em>o</em><em>n</em><em>s</em><em>з</em><em>а</em><em>в</em><em>е</em><em>р</em><em>ш</em><em>е</em><em>н</em><em>а</em></span>{NC}”
echo -e “<span
class="math inline"><em>Y</em><em>E</em><em>L</em><em>L</em><em>O</em><em>W</em>📁<em>В</em><em>с</em><em>е</em><em>ф</em><em>а</em><em>й</em><em>л</em><em>ы</em><em>в</em>:</span>{NC}
$DEMO_DIR”</p>
<pre><code>
---

## 📚 ИТОГОВАЯ ТАБЛИЦА ВСЕХ ТЕРМИНОВ

| Термин | Определение | Ключевая команда |
|--------|-------------|-------------------|
| **Parameter Substitution** | Манипуляция строками в Bash | `${var#pattern}`, `${var%pattern}` |
| **Directory Tree Mirroring** | Зеркальное копирование структуры | `target=&quot;${WORK_DIR}/${top} - ${fmt}${sub}&quot;` |
| **Idempotency** | Безопасность повторных запусков | `[ -f &quot;$file&quot; ] &amp;&amp; ...` |
| **Reference-doc Workflow** | Конвертация через шаблон | `--reference-doc=template.docx` |
| **Pandoc Extensions** | Расширения Markdown | `--from=markdown+pipe_tables` |

---

## ✅ ЗАКЛЮЧЕНИЕ

Теперь у тебя есть **ПОЛНЫЙ УЧЕБНЫЙ СПРАВОЧНИК** по всем ключевым терминам:

1. 📖 **Определение** - что это такое
2. 🎨 **Графический рисунок** - как это выглядит
3. 💻 **Скрипт для Termux** - практика в Bash
4. 🐍 **Скрипт для Pydroid 3** - практика в Python

Все файлы можно сохранить в папку настроек Termux для быстрого доступа:

```bash
# Сохранить справочник
cat &gt; &quot;/storage/emulated/0/Documents/15_Настройки_скрипты_Termux_бекап_рестор/08_Полный_справочник_терминов.md&quot; &lt;&lt; &#39;EOF&#39;
[вставить весь текст выше]
EOF</code></pre>
<p>.</p>
<section id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>…<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</body>
</html>
